(function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],d=0,m=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&m.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(m.length)m.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==r[l]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={app:0},s=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"019a":function(e,t,a){"use strict";a("d826")},"0f1d":function(e,t,a){},"0f60":function(e,t,a){"use strict";a("d207")},"0fae":function(e,t,a){"use strict";a("49b0")},"16df":function(e,t,a){},"172b":function(e,t,a){"use strict";a("a98b")},"1add":function(e,t,a){},"1bfe":function(e,t,a){},"1cfa":function(e,t,a){"use strict";a("ab0f")},"20d2":function(e,t,a){"use strict";a("5fa1")},"2b1c":function(e,t,a){"use strict";a("c845")},"2c25":function(e,t,a){},"2d92":function(e,t,a){"use strict";a("9c7a")},"35a9":function(e,t,a){},"37b9":function(e,t,a){"use strict";a("f376")},"37d2":function(e,t,a){},4142:function(e,t,a){"use strict";a("ef38")},"42dd":function(e,t,a){},4551:function(e,t,a){},"47ce":function(e,t,a){"use strict";a("c25e")},"49b0":function(e,t,a){},"4de4":function(e,t,a){},"4e4c":function(e,t,a){"use strict";a("35a9")},"4e79":function(e,t,a){"use strict";a("9864")},"54b8":function(e,t,a){"use strict";a("5da2")},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("ba4c"),r=a.n(n),s=a("660e");r.a.use(s["a"],{breakpoints:{mobile:450,tablet:900,laptop:1250,desktop:1/0}});var i=a("8c4f");r.a.use(i["a"]);var o=a("ce5b"),l=a.n(o);a("bf40"),a("5363");r.a.use(l.a,{theme:{primary:"#ea80fc",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"},iconfont:"mdi"});var c=a("b079"),u=a.n(c);a("4238");r.a.use(u.a,{position:"top"});var d=a("ca95"),m=a.n(d),p=a("8cb8"),f=function(){var e=this,t=e._self._c;return e.isLoggedIn?e._e():t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-form"},[t("h1",[e._v("INDOBENUA")]),e.loading?t("div",[t("i",{staticClass:"fa fa-spinner fa-spin"})]):t("form",{on:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"username"}},[e._v("Username")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",id:"username",required:"",autocomplete:"off"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e.errors.username?t("span",{staticClass:"error-message"},[e._v(e._s(e.errors.username[0]))]):e._e()]),t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"password"}},[e._v("Password")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",id:"password",required:"",autocomplete:"off"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e.errors.password?t("span",{staticClass:"error-message"},[e._v(e._s(e.errors.password[0]))]):e._e()]),t("button",{staticClass:"submit-button",attrs:{type:"submit"}},[e._v("Login")])]),e.errors.general?t("span",{staticClass:"error-message"},[e._v(e._s(e.errors.general))]):e._e()])])},v=[],h=(a("96cf"),a("1da1")),g=(a("7f7f"),a("faac")),b=a.n(g),_=(a("a481"),a("cee4")),k=(a("4917"),a("2f62"));r.a.use(k["a"]);var C=new k["a"].Store({state:{user:null,isLoading:!1,statistic:{},isWorker:!0},mutations:{setUser:function(e,t){e.user=t,e.isWorker=t.jabatan&&t.jabatan.name.match(/helper|teknisi|driver/i)},setLoading:function(e,t){e.isLoading=t},setStatistic:function(e,t){e.statistic=t}},actions:{fetchUser:function(e){return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.commit,t.prev=1,t.next=4,T.get("/user");case 4:n=t.sent,r=n.data,a("setUser",r),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error("Failed to fetch user data:",t.t0);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))()},setLoading:function(e,t){var a=e.commit;a("setLoading",t)},setStatistic:function(e){return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.commit,t.prev=1,t.next=4,T.get("/statistic");case 4:n=t.sent,a("setStatistic",n.data),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:case"end":return t.stop()}}),t,null,[[1,8]])})))()}}}),w=(a("ac6a"),"myAppDB"),y=1,x="tasks",O="serviceCalls";function P(){return new Promise((function(e,t){var a=indexedDB.open(w,y);a.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains(x)||t.createObjectStore(x,{keyPath:"id"}),t.objectStoreNames.contains(O)||t.createObjectStore(O,{keyPath:"id"})},a.onsuccess=function(t){e(t.target.result)},a.onerror=function(e){t(e.target.error)}}))}function S(e,t){return P().then((function(a){return new Promise((function(n,r){var s=a.transaction([e],"readwrite"),i=s.objectStore(e);t.forEach((function(e){i.put(e)})),s.oncomplete=function(){n()},s.onerror=function(e){r(e.target.error)}}))}))}function j(e){return P().then((function(t){return new Promise((function(a,n){var r=t.transaction([e],"readonly"),s=r.objectStore(e),i=s.getAll();i.onsuccess=function(e){a(e.target.result)},i.onerror=function(e){n(e.target.error)}}))}))}function L(e){return P().then((function(t){return new Promise((function(a,n){var r=t.transaction([e],"readwrite"),s=r.objectStore(e),i=s.clear();i.onsuccess=function(){a()},i.onerror=function(e){n(e.target.error)}}))}))}function D(e,t,a,n){return I.apply(this,arguments)}function I(){return I=Object(h["a"])(regeneratorRuntime.mark((function e(t,a,n,r){var s,i,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:return s=e.sent,i=s.transaction(t,"readwrite"),o=i.objectStore(t),l=o.get(a),l.onsuccess=function(){var e=l.result;if(e){switch(r){case"comments":e.task.comments=n;break;case"note":e.note=n;break;case"sc":e.status=n.status,e.lines=n.lines;break}o.put(e)}},e.abrupt("return",new Promise((function(e,t){i.oncomplete=e,i.onerror=t})));case 8:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function F(){return new Promise((function(e,t){var a=indexedDB.deleteDatabase(w);a.onsuccess=function(){console.log("Database deleted successfully"),e()},a.onerror=function(e){console.error("Error deleting database:",e),t(e)},a.onblocked=function(){console.warn("Database deletion blocked"),t(new Error("Database deletion blocked"))}}))}var R=_["a"].create({baseURL:"https://ac.igm.biz.id/api",headers:{"Content-Type":"application/json"}});R.interceptors.request.use((function(e){var t=localStorage.getItem("api_token");return t&&(e.headers["Authorization"]="Bearer ".concat(t)),C.dispatch("setLoading",!0),e}),(function(e){return C.dispatch("setLoading",!1),Promise.reject(e)})),R.interceptors.response.use((function(e){return C.dispatch("setLoading",!1),e}),(function(e){if(e&&e.response&&e.response.status&&401===e.response.status){if("/test"===location.pathname)return void C.dispatch("setLoading",!1);console.log("User tidak autentik"),localStorage.clear(),F(),"/login"!==location.pathname&&location.replace("/login")}return C.dispatch("setLoading",!1),Promise.reject(e)}));var T=R,M={data:function(){return{username:"",password:"",deviceName:"",errors:{},loading:!1,isLoggedIn:!1}},mounted:function(){this.deviceName=b.a.name+" "+b.a.version},created:function(){var e=localStorage.getItem("api_token");e&&(this.isLoggedIn=!0,this.$router.push("/"))},methods:{login:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.errors={},e.loading=!0,t.prev=2,t.next=5,T.post("/login",{username:e.username,password:e.password,device_name:e.deviceName});case 5:a=t.sent,a.data&&a.data.token?(localStorage.setItem("api_token",a.data.token),localStorage.setItem("user_id",a.data.user.id),e.isLoggedIn=!0,e.$router.go("/")):e.errors.general="Login failed. Please check your credentials and try again.",t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),t.t0.response&&422===t.t0.response.status?e.errors=t.t0.response.data.errors||{}:e.errors.general="Login failed. Please check your credentials and try again.";case 12:return t.prev=12,e.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[2,9,12,15]])})))()}}},A=M,N=(a("37b9"),a("0c7c")),E=Object(N["a"])(A,f,v,!1,null,"785292e9",null),q=E.exports,$=function(){var e=this,t=e._self._c;return e.user?t("div",{staticClass:"home-container"},[t("div",{staticClass:"welcome-message"},[e._v(" Welcome, "+e._s(e.user.surname)+" "+e._s(e.user.first_name)+" "+e._s(e.user.last_name)+" ")]),e.statistic.HtmlInfo?t("div",{staticClass:"webview-container",style:{height:e.webViewHeight+"px"}},[t("iframe",{ref:"iframe",staticClass:"webview",attrs:{srcdoc:e.statistic.HtmlInfo},on:{load:e.handleIframeLoad}})]):e._e(),t("AbsensiSlider",{attrs:{location:e.location}}),t("div",{staticClass:"location-text"},[e._v(e._s(e.locationText))])],1):e._e()},B=[],z=(a("8e6e"),a("456d"),a("ade3"));function U(e){return V.apply(this,arguments)}function V(){return V=Object(h["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t||!t.showLoc){e.next=4;break}return e.next=3,K();case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",new Promise((function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e({position:a});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(e){t(new Error("Geolocation error: ".concat(e.message)))})):t(new Error("Geolocation is not supported by this browser."))})));case 5:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function K(){return J.apply(this,arguments)}function J(){return J=Object(h["a"])(regeneratorRuntime.mark((function e(){var t,a,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U();case 3:return t=e.sent,a=t.position,n="https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=".concat(a.coords.latitude,"&lon=").concat(a.coords.longitude),e.next=8,T.get(n);case 8:if(r=e.sent,r.data){e.next=11;break}throw new Error("Indobenua");case 11:return s=r.data,e.abrupt("return",{position:a,loc:s});case 15:throw e.prev=15,e.t0=e["catch"](0),new Error("Failed to fetch location details: ".concat(e.t0.message));case 18:case"end":return e.stop()}}),e,null,[[0,15]])}))),J.apply(this,arguments)}var H=function(){var e=this,t=e._self._c;return t("div",[e.loading?t("div",{staticClass:"loading-overlay"},[t("ActivityIndicator",{attrs:{size:"large",color:"#000"}})],1):e._e(),t("div",{staticClass:"container"},[t("h3",[e._v("Absensi Kehadiran")]),t("div",{staticClass:"container-box"},[t("div",{staticClass:"slider-container"},[t("div",{staticClass:"slider-button",style:{transform:"translateX(".concat(e.slidePosition,"px)"),backgroundColor:e.sliderColor},on:{mousedown:e.startPan,mousemove:e.handlePan,mouseup:e.endPan}},[t("span",{staticClass:"slider-icon"},[e._v("»")])]),t("div",{staticClass:"slider-background"},[t("p",{staticClass:"slider-text"},[e._v(e._s(e.labelSlider))])])])])]),t("div",{staticClass:"attendance-container-wrapper"},[t("div",{staticClass:"attendance-container"},[t("p",{staticClass:"attendance-title"},[e._v("Check Clock Terakhir:")]),e._l(e.attendance,(function(a,n){return t("div",{key:n,staticClass:"attendance-card"},[null!==a&&void 0!==a&&a.clock_out_time?t("p",{staticClass:"clock-out-text"},[e._v(" Absen Keluar hari "+e._s(e.getDayName(a.clock_out_time))+" jam "+e._s(e.formatTime(null===a||void 0===a?void 0:a.clock_out_time))+" ")]):e._e(),null!==a&&void 0!==a&&a.clock_in_time?t("p",{staticClass:"clock-in-text"},[e._v(" Absen Masuk hari "+e._s(e.getDayName(a.clock_in_time))+" jam "+e._s(e.formatTime(null===a||void 0===a?void 0:a.clock_in_time))+" ")]):e._e()])}))],2)])])},Q=[];a("6762"),a("2fdb");function G(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?G(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):G(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Y={props:{location:Object},data:function(){return{loading:!1,isPanning:!1,slidePosition:0,maxSlideDistance:250}},computed:W(W({},Object(k["c"])(["statistic"])),{},{attendance:function(){var e;return(null===(e=this.statistic)||void 0===e||null===(e=e.check_clock)||void 0===e?void 0:e.attendance)||[]},isSliderEnabled:function(){var e;return["enableClockIn","enableClockOut"].includes(null===(e=this.statistic)||void 0===e||null===(e=e.check_clock)||void 0===e?void 0:e.status)},labelSlider:function(){var e,t;return"enableClockIn"===(null===(e=this.statistic)||void 0===e||null===(e=e.check_clock)||void 0===e?void 0:e.status)?"Geser untuk Check Clock In":"enableClockOut"===(null===(t=this.statistic)||void 0===t||null===(t=t.check_clock)||void 0===t?void 0:t.status)?"Geser untuk Check Clock Out":"Tidak Tersedia"},sliderColor:function(){return this.isSliderEnabled?"green":"#ccc"}}),methods:{handleSlideComplete:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=null!==(a=e.labelSlider)&&void 0!==a&&a.includes("In")?"in":"out",r=e.location||{},s=r.latitude,i=r.longitude,o=r.loc,l={type:n,latitude:s,longitude:i,location:null===o||void 0===o?void 0:o.display_name},t.next=6,T.post("/check-clock",l);case 6:c=t.sent,c.data.success?(e.isSliderEnabled=!1,u=(new Date).toLocaleTimeString(),e.labelSlider="Sukses ".concat("in"===n?"Clock In":"Clock Out"," pada jam ").concat(u),e.sliderColor="blue"):(alert((null===(d=c.data)||void 0===d?void 0:d.msg)||"Gagal melakukan clock!"),e.resetSlider()),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),alert("Gagal terhubung ke server"),e.resetSlider();case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},resetSlider:function(){this.slidePosition=0},startPan:function(e){this.isSliderEnabled&&(this.isPanning=!0,e.preventDefault())},handlePan:function(e){if(this.isPanning){var t=e.movementX;this.slidePosition+t>=0&&this.slidePosition+t<=this.maxSlideDistance&&(this.slidePosition+=t)}},endPan:function(){this.isPanning=!1,this.slidePosition>=this.maxSlideDistance?(this.isSliderEnabled=!1,this.handleSlideComplete()):this.resetSlider()},getDayName:function(e){var t=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],a=new Date(e);return t[a.getDay()]},formatTime:function(e){var t=new Date(e);return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},mounted:function(){}},X=Y,Z=(a("8e99"),Object(N["a"])(X,H,Q,!1,null,"7e337505",null)),ee=Z.exports;function te(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?te(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):te(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ne={components:{AbsensiSlider:ee},data:function(){return{loading:!0,errorMsg:null,position:null,locationDetails:null,deviceName:"",refreshing:!1,webViewHeight:0}},computed:ae(ae({},Object(k["c"])(["user","statistic"])),{},{locationText:function(){return this.errorMsg?this.errorMsg:this.locationDetails?this.locationDetails.display_name:"Waiting.."},location:function(){return this.position&&this.locationDetails?{latitude:this.position.coords.latitude,longitude:this.position.coords.longitude,display_name:this.locationDetails.display_name}:{}}}),methods:{fetchLocation:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,U({showLoc:!0});case 3:a=t.sent,n=a.position,r=a.loc,e.position=n,e.locationDetails=r,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("Failed to fetch location:",t.t0),e.errorMsg=t.t0.message;case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},onRefresh:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.refreshing=!0,t.next=3,e.fetchLocation();case 3:e.refreshing=!1;case 4:case"end":return t.stop()}}),t)})))()},handleIframeLoad:function(){var e=this.$refs.iframe;this.webViewHeight=e.contentWindow.document.body.scrollHeight}},mounted:function(){this.deviceName=b.a.name+" "+b.a.version,this.fetchLocation(),console.log(this.statistic)}},re=ne,se=(a("172b"),Object(N["a"])(re,$,B,!1,null,"a6aaad1e",null)),ie=se.exports,oe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-container"},[t("div",{staticClass:"header-container"},[t("div",{staticClass:"filter-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"input",attrs:{type:"text",placeholder:"Search..."},domProps:{value:e.searchText},on:{input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),t("button",{staticClass:"filter",on:{click:e.toggleDateFilterModal}},[e._v(" "+e._s(e.dateFilter)+" ")]),t("button",{staticClass:"filter",style:{backgroundColor:e.getStatusFilterColor()},on:{click:e.toggleStatusFilterModal}},[e._v(" "+e._s(e.statusFilter)+" ")])])]),e.loading?t("div",{staticClass:"loading-indicator"},[e._m(0)]):e.filteredTasks.length?t("div",{staticClass:"tasks-list"},e._l(e.filteredTasks,(function(a,n){var r,s,i,o;return t("div",{key:n,staticClass:"task-item"},[t("router-link",{staticClass:"task-link",attrs:{to:{name:"DetailTask",params:{task:a,id:a.id}}}},[t("div",{staticClass:"item",style:{backgroundColor:e.getStatusFilterColor()}},[e.isWorker?e._e():t("div",{staticClass:"tech-name"},[e._v(" "+e._s(null===(r=a.store)||void 0===r||null===(r=r.route)||void 0===r||null===(r=r.teknisi)||void 0===r?void 0:r.nickname)+" ")]),t("div",{staticClass:"avatar"},[t("span",{staticClass:"avatar-text"},[e._v(e._s(null===(s=a.store)||void 0===s?void 0:s.store_code))])]),t("div",{staticClass:"item-content"},[t("div",{staticClass:"title"},[e._v(e._s(null===(i=a.store)||void 0===i||null===(i=i.route)||void 0===i?void 0:i.index_route)+". "+e._s(null===(o=a.store)||void 0===o?void 0:o.store_name))]),t("div",{staticClass:"description"},[e._v(e._s(a.trx_no)+" Periode: "+e._s(a.periode))]),t("div",{staticClass:"reminder"},[e._v(" "+e._s(a.previous_month_projects.reduce((function(e,t){return(e?"":"REMINDER: ")+t.note}),"").substr(0,50))+" ")])]),t("div",{staticClass:"right-column"},[t("div",{staticClass:"req-date"},[e._v(e._s(e.formatDate(a.req_date)))])])])])],1)})),0):t("div",{staticClass:"empty-message"},[t("div",[e._v("No tasks available.")])]),e.isDateFilterModalVisible?t("div",{staticClass:"modal-backdrop"},[t("div",{staticClass:"modal-container"},[t("button",{on:{click:function(t){return e.selectDateFilter("Hari Ini")}}},[e._v("Hari Ini")]),t("button",{on:{click:function(t){return e.selectDateFilter("Minggu Ini")}}},[e._v("Minggu Ini")]),t("button",{on:{click:function(t){return e.selectDateFilter("Bulan Ini")}}},[e._v("Bulan Ini")])])]):e._e(),e.isStatusFilterModalVisible?t("div",{staticClass:"modal-backdrop"},[t("div",{staticClass:"modal-container"},[t("button",{on:{click:function(t){return e.selectStatusFilter("Pending")}}},[e._v("Pending")]),t("button",{on:{click:function(t){return e.selectStatusFilter("Review")}}},[e._v("Review")]),t("button",{on:{click:function(t){return e.selectStatusFilter("Lengkap")}}},[e._v("Lengkap")])])]):e._e()])},le=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"loading-text"},[t("div",{staticClass:"fa fa-spinner"})])}];a("55dd");function ce(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ce(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var de={data:function(){return{loading:!1,tasks:[],searchText:"",dateFilter:"Hari Ini",statusFilter:"Pending",isDateFilterModalVisible:!1,isStatusFilterModalVisible:!1}},computed:ue(ue({},Object(k["c"])(["statistic","isWorker"])),{},{filteredTasks:function(){var e=this;return this.tasks.filter((function(t){var a,n,r,s;return((null===(a=t.store)||void 0===a?void 0:a.store_name.toLowerCase().includes(e.searchText.toLowerCase()))||(null===(n=t.task)||void 0===n?void 0:n.subject.toLowerCase().includes(e.searchText.toLowerCase()))||(null===(r=t.store)||void 0===r||null===(r=r.route)||void 0===r||null===(r=r.teknisi)||void 0===r||null===(r=r.nickname)||void 0===r?void 0:r.toLowerCase().includes(e.searchText.toLowerCase()))||(null===(s=t.store)||void 0===s?void 0:s.store_code.toLowerCase().includes(e.searchText.toLowerCase())))&&e.filterTasks(t)}))}}),methods:{fetchTasks:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,T.get("/task");case 4:return a=t.sent,e.tasks=a.data,t.next=8,L("tasks");case 8:return t.next=10,S("tasks",e.tasks);case 10:e.statistic.tasks=e.tasks,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](1),console.error("Error fetching tasks:",t.t0);case 16:return t.prev=16,e.loading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[1,13,16,19]])})))()},filterTasks:function(e){var t=this,a=new Date,n=new Date(e.req_date),r=function(){if("Hari Ini"===t.dateFilter)return n.toDateString()===a.toDateString();if("Minggu Ini"===t.dateFilter){var e=new Date(a.setDate(a.getDate()-a.getDay())),r=new Date(a.setDate(a.getDate()-a.getDay()+6));return n>=e&&n<=r}if("Bulan Ini"===t.dateFilter){var s=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,0);return n>=s&&n<=i}return!0}(),s=function(){return"Lengkap"===t.statusFilter?"completed"===e.task.status:"Review"===t.statusFilter?"in_progress"===e.task.status&&e.task.comments&&e.task.comments.length>0:"Pending"!==t.statusFilter||"in_progress"===e.task.status&&(!e.task.comments||0===e.task.comments.length)}();return"Hari Ini"===this.dateFilter&&"Pending"===this.statusFilter?n<=a&&s:r&&s},toggleDateFilterModal:function(){this.isDateFilterModalVisible=!this.isDateFilterModalVisible},toggleStatusFilterModal:function(){this.isStatusFilterModalVisible=!this.isStatusFilterModalVisible},selectDateFilter:function(e){this.dateFilter=e,this.isDateFilterModalVisible=!1},selectStatusFilter:function(e){this.statusFilter=e,this.isStatusFilterModalVisible=!1},getStatusFilterColor:function(){switch(this.statusFilter){case"Pending":return"#fff3b0";case"Review":return"#b2f0f0";case"Lengkap":return"#d4f8d4";default:return"#fff"}},formatDate:function(e){var t=new Date(e);return t.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit"})},checkDataTasks:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,j("tasks");case 3:if(a=t.sent,n=localStorage.getItem("lastUpdate_tasks"),r=(new Date).getTime(),s=n&&r-n>144e5,a.length&&!s){t.next=13;break}return t.next=10,e.fetchTasks();case 10:localStorage.setItem("lastUpdate_tasks",r),t.next=14;break;case 13:e.tasks=a.sort((function(e,t){var a,n;return(null===(a=e.store)||void 0===a||null===(a=a.route)||void 0===a?void 0:a.index_route)-(null===(n=t.store)||void 0===n||null===(n=n.route)||void 0===n?void 0:n.index_route)}));case 14:e.statistic.task_count=e.tasks.filter((function(e){return"in_progress"===e.task.status&&!e.task.comments.length&&new Date(e.req_date).getDate()<=(new Date).getDate()})).length,e.loading=!1;case 16:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.checkDataTasks();case 1:case"end":return t.stop()}}),t)})))()}},me=de,pe=(a("9650"),Object(N["a"])(me,oe,le,!1,null,"a336a82e",null)),fe=pe.exports,ve=function(){var e,t,a,n,r,s,i,o=this,l=o._self._c;return l("div",[l("div",{ref:"detailTaskContainer",staticClass:"detail-task-container"},[l("div",{staticClass:"header"},[l("router-link",{staticClass:"back-button",attrs:{to:"/task"}},[o._v("Back to Tasks")]),l("h1")],1),o.task?l("div",[l("div",{staticClass:"task-detail"},[l("h2",[o._v(o._s(null===(e=o.task.store)||void 0===e?void 0:e.store_name))]),l("p",[l("strong",[o._v("Kode Toko:")]),o._v(" "+o._s(null===(t=o.task.store)||void 0===t?void 0:t.store_code))]),l("p",[l("strong",[o._v("Rute:")]),o._v(" "+o._s(null===(a=o.task.store)||void 0===a||null===(a=a.route)||void 0===a?void 0:a.index_route))]),l("p",[l("strong",[o._v("Nomer Transaksi:")]),o._v(" "+o._s(o.task.trx_no))]),l("p",[l("strong",[o._v("Periode:")]),o._v(" "+o._s(o.task.periode))]),l("p",[l("strong",[o._v("Request Date:")]),o._v(" "+o._s(o.formatDate(o.task.req_date)))]),l("p",[l("strong",[o._v("Status:")]),o._v(" "+o._s(null===(n=o.task.task)||void 0===n?void 0:n.status))])]),l("div",{staticClass:"infoContainer"},[l("div",{staticClass:"infoBox"},[l("div",{staticClass:"infoTitle"},[o._v("Catatan bulan lalu:")]),l("div",{staticClass:"red-text"},[o._v(" "+o._s(null!==(r=o.task)&&void 0!==r&&r.previous_month_projects&&null!==(s=o.task)&&void 0!==s&&null!==(s=s.previous_month_projects)&&void 0!==s&&s.length?null===(i=o.task)||void 0===i||null===(i=i.previous_month_projects)||void 0===i?void 0:i.reduce((function(e,t){return e+t.note}),""):"")+" ")])]),l("div",{staticClass:"infoBox"},[l("div",{staticClass:"infoTitle"},[o._v("Tambahkan Catatan bulan ini:")]),l("Modal",{attrs:{isVisible:o.isModalVisible,task:o.task},on:{close:o.closeModal,success:o.handleSuccess}}),l("div",{staticClass:"red-text",on:{click:o.openModal}},[o.task.note?l("span",[o._v(" "+o._s(o.task.note)+"  "),l("i",{staticClass:"fas fa-edit"})]):l("span",{staticClass:"icon-plus danger",on:{click:o.openModal}},[l("i",{staticClass:"fas fa-plus-circle"})])])],1)]),l("hr"),l("div",[l("ul",{ref:"commentList",staticClass:"comment-list"},o._l(o.comments,(function(e,t){var a;return l("li",{key:t},[l("div",{class:{"comment-content current-user-content":e.commented_by.id===o.currentUserId,"comment-content other-user-content":e.commented_by.id!==o.currentUserId}},[l("div",{staticClass:"comment-header"},[l("span",{staticClass:"commented-by"},[o._v(o._s(null===e||void 0===e||null===(a=e.commented_by)||void 0===a?void 0:a.nickname))]),l("span",{staticClass:"comment-time"},[o._v(o._s(null===e||void 0===e?void 0:e.created_at))])]),e.media&&e.media.length?l("div",{staticClass:"comment-images"},o._l(e.media,(function(e,t){return l("img",{key:t,staticClass:"comment-image",attrs:{src:e.display_url,alt:"Comment image "+t,title:e.display_name}})})),0):o._e(),o._v(" "+o._s(e.comment)+" ")])])})),0)])]):l("div",{staticClass:"loading-indicator"},[l("i",{staticClass:"fa fa-spinner fa-spin"})])]),o.previewImages.length?l("div",{staticClass:"preview-image-container"},o._l(o.previewImages,(function(e,t){return l("div",{key:t,staticClass:"preview-image-wrapper"},[l("img",{staticClass:"preview-image",attrs:{src:e.data,alt:e.name}}),l("div",{staticClass:"image-details"},[l("span",[o._v("Size: "+o._s(o.formatFileSize(e.size)))])]),l("span",{staticClass:"remove-image",on:{click:function(e){return o.removePreviewImage(t)}}},[o._v("×")])])})),0):o._e(),l("div",{staticClass:"input-form"},[l("textarea",{directives:[{name:"model",rawName:"v-model",value:o.additionalText,expression:"additionalText"}],staticClass:"text-input",attrs:{placeholder:"Tambahkan pesan..."},domProps:{value:o.additionalText},on:{input:function(e){e.target.composing||(o.additionalText=e.target.value)}}}),l("div",{staticClass:"icons"},[l("label",{staticClass:"file-upload-button",attrs:{for:"file-upload"}},[l("i",{staticClass:"fas fa-paperclip"}),l("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{id:"file-upload",type:"file",multiple:"",accept:"image/*"},on:{change:o.handleFileUpload}})]),l("button",{staticClass:"send-button",on:{click:o.submitData}},[l("i",{staticClass:"fas fa-paper-plane"})])])]),o.isCompressing?l("div",{staticClass:"compressing-indicator"},[l("i",{staticClass:"fas fa-spinner fa-spin"}),o._v(" Mengompres gambar... ")]):o._e()])},he=[],ge=(a("34ef1"),a("28a5"),a("f559"),a("2909")),be=(a("5df3"),a("1c4c"),function(){var e=this,t=e._self._c;return e.isVisible?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:e.closeModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("span",{staticClass:"close",on:{click:e.closeModal}},[e._v("×")]),t("h2",{staticClass:"reminder-title"},[e._v("Add Reminder")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[e._m(0),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reminderText,expression:"reminderText"}],attrs:{placeholder:"Tulis disini",id:"reminder",required:""},domProps:{value:e.reminderText},on:{input:function(t){t.target.composing||(e.reminderText=t.target.value)}}})]),t("button",{staticClass:"btn-submit-modal",attrs:{type:"submit"}},[e._v("Simpan!")])])])]):e._e()}),_e=[function(){var e=this,t=e._self._c;return t("label",{attrs:{for:"reminder"}},[t("small",[e._v("Untuk pengingat bulan depan:")])])}];function ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var we={name:"Modal",props:["isVisible","task"],data:function(){return{reminderText:""}},methods:{closeModal:function(){this.$emit("close")},submitForm:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("/reminder/"+e.task.id,{reminder_message:e.reminderText});case 3:a=t.sent,200===a.status&&(e.$emit("success",Ce(Ce({},a.data),{},{reminderText:e.reminderText})),e.closeModal()),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error submitting reminder:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},created:function(){this.reminderText=this.task.note}},ye=we,xe=(a("64a4"),Object(N["a"])(ye,be,_e,!1,null,null,null)),Oe=xe.exports,Pe={components:{Modal:Oe},data:function(){return{task:this.$route.params.task||null,additionalText:"",previewImages:[],isModalVisible:!1,currentUserId:JSON.parse(localStorage.getItem("user_id")||"1"),isCompressing:!1}},created:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.$route.params.id||null,null===(a=e.$route)||void 0===a||null===(a=a.params)||void 0===a||!a.task){t.next=5;break}e.task=e.$route.params.task,t.next=9;break;case 5:if(!s){t.next=9;break}return t.next=8,e.fetchTask(s);case 8:e.task=t.sent;case 9:e.task&&null!==(n=e.task)&&void 0!==n&&n.task&&null!==(r=e.task)&&void 0!==r&&null!==(r=r.task)&&void 0!==r&&r.comments?e.comments=e.task.task.comments||[]:(e.comments=[],console.warn("Task or comments not available")),e.scrollToBottom();case 11:case"end":return t.stop()}}),t)})))()},methods:{fetchTask:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.prev=1,a.next=4,T.get("/task/".concat(e));case 4:return n=a.sent,a.abrupt("return",n.data);case 8:a.prev=8,a.t0=a["catch"](1),console.error("Error fetching service call:",a.t0),r.a.$toast.error("Error","Gagal memuat data service call.");case 12:return a.prev=12,t.loading=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[1,8,12,15]])})))()},formatDate:function(e){var t=new Date(e);return t.toLocaleDateString("id-ID")},formatFileSize:function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(0)+" "+["B","kB","MB","GB","TB"][t]},handleFileUpload:function(e){var t=this,a=Array.from(e.target.files);this.isCompressing=!0,console.log("Starting compression..."),Promise.all(a.map((function(e){return t.readAndCompressImage(e)}))).then((function(e){var a;console.log("Compressed Images:",e),(a=t.previewImages).push.apply(a,Object(ge["a"])(e))})).finally((function(){t.isCompressing=!1}))},readAndCompressImage:function(e){var t=this;return new Promise((function(a,n){var s=new FileReader;e.type.startsWith("image/")?(s.onload=function(){var r=Object(h["a"])(regeneratorRuntime.mark((function r(s){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.compressImage(s.target.result,e.name);case 3:i=r.sent,console.log("Compressed Image:",i),a(i),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),n(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}(),s.onerror=function(e){return n(e)},s.readAsDataURL(e)):r.a.$toast.error("Hanya file gambar yang diperbolehkan.")}))},compressImage:function(e,t){return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Image,n.src=e,a.abrupt("return",new Promise((function(e,a){n.onload=function(){var r=document.createElement("canvas"),s=r.getContext("2d"),i=800,o=n.width,l=n.height;o>l?o>i&&(l=Math.round(l*=i/o),o=i):l>i&&(o=Math.round(o*=i/l),l=i),r.width=o,r.height=l,s.drawImage(n,0,0,o,l);var c,u=.8;do{c=r.toDataURL("image/jpeg",u);for(var d=atob(c.split(",")[1]),m=new ArrayBuffer(d.length),p=new Uint8Array(m),f=0;f<d.length;f++)p[f]=d.charCodeAt(f);var v=new Blob([m],{type:"image/jpeg"});if(v.size<=204800)return void e({name:t,data:c,file:v,filemtime:Date.now(),size:v.size});u-=.1}while(u>0);a("Failed to compress image below 200KB")},n.onerror=function(e){return a(e)}})));case 3:case"end":return a.stop()}}),a)})))()},removePreviewImage:function(e){this.previewImages.splice(e,1),this.$refs.fileUpload.value=null},submitData:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,s,i,o,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.additionalText.trim()){t.next=3;break}return r.a.$toast.error("Tambahkan pesan terlebih dahulu"),t.abrupt("return");case 3:return a=new FormData,a.append("alfa_id",e.task.id),a.append("task_id",e.task.task.id),a.append("comment",e.additionalText),t.next=9,U();case 9:return n=t.sent,s=n.position,s&&(a.append("latitude",null===s||void 0===s||null===(i=s.coords)||void 0===i?void 0:i.latitude),a.append("longitude",null===s||void 0===s||null===(o=s.coords)||void 0===o?void 0:o.longitude)),e.previewImages.forEach((function(e){a.append("photos[]",e.file,e.name),a.append("filemtimes[]",e.filemtime)})),t.prev=13,t.next=16,T.post("/task",a,{headers:{"Content-Type":"multipart/form-data"}});case 16:if(l=t.sent,c=l.data,!c.success){t.next=25;break}return e.comments=c.data.comments,e.additionalText="",e.previewImages=[],e.scrollToBottom(),t.next=25,D("tasks",e.task.id,e.comments,"comments");case 25:t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](13),r.a.$toast.error("Error: "+JSON.stringify(t.t0)),console.error("Error submitting data:",t.t0);case 31:case"end":return t.stop()}}),t,null,[[13,27]])})))()},openModal:function(){this.isModalVisible=!0},closeModal:function(){this.isModalVisible=!1},handleSuccess:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.success){a.next=4;break}return t.task.note=e.reminderText,a.next=4,D("tasks",t.task.id,e.reminderText,"note");case 4:console.log("Reminder added successfully:",e);case 5:case"end":return a.stop()}}),a)})))()},scrollToBottom:function(){var e=this;this.$nextTick((function(){var t=e.$refs.detailTaskContainer;setTimeout((function(){t.scrollTop=t.scrollHeight}),200)}))}}},Se=Pe,je=(a("b4d8"),Object(N["a"])(Se,ve,he,!1,null,"ee416450",null)),Le=je.exports,De=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"filter-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"input",attrs:{placeholder:"Search..."},domProps:{value:e.searchText},on:{input:function(t){t.target.composing||(e.searchText=t.target.value)}}}),t("button",{staticClass:"filter",style:{backgroundColor:e.getStatusFilterColor()},on:{click:function(t){e.isStatusFilterModalVisible=!0}}},[e._v(" "+e._s(e.statusFilter)+" ")])]),e.loading?t("div",{staticClass:"loading-indicator"},[t("i",{staticClass:"fa fa-spinner fa-spin"})]):t("div",[e.filteredServiceCalls.length?t("ul",{staticClass:"service-call-list"},e._l(e.filteredServiceCalls,(function(a,n){return t("li",{key:n,staticClass:"service-call-item",style:{backgroundColor:e.getStatusFilterColor()},on:{click:function(t){return e.navigateToDetail(a)}}},[e.isWorker?e._e():t("div",{staticClass:"tech-name"},[e._v(" "+e._s(a.store.route&&a.store.route.teknisi&&a.store.route.teknisi.nickname)+" ")]),e._m(0,!0),t("div",{staticClass:"item-content"},[t("p",{staticClass:"title"},[e._v(e._s(a.store&&a.store.store_code)+" "+e._s(a.store&&a.store.store_name))]),t("p",{staticClass:"description"},[e._v(e._s(a.subject))])]),t("div",{staticClass:"right-column"},[t("p",{staticClass:"tgl"},[e._v(e._s(e.formatDate(a.trx_date)))])])])})),0):t("div",{staticClass:"centered-view"},[t("p",{staticClass:"centered-text"},[e._v("Tidak ada service call saat ini.")])])]),t("transition",{attrs:{name:"fade"}},[e.isStatusFilterModalVisible?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-backdrop",on:{click:function(t){e.isStatusFilterModalVisible=!1}}}),t("div",{staticClass:"modal-container"},[t("button",{staticClass:"pending",on:{click:function(t){return e.setStatusFilter("Pending")}}},[e._v("Pending")]),t("button",{staticClass:"progress",on:{click:function(t){return e.setStatusFilter("Progress")}}},[e._v("Progress")]),t("button",{staticClass:"solved",on:{click:function(t){return e.setStatusFilter("Solved")}}},[e._v("Solved")])])]):e._e()])],1)},Ie=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"avatar"},[t("i",{staticClass:"fa fa-phone",attrs:{"aria-hidden":"true"}})])}];function Fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Re(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Te={data:function(){return{loading:!1,serviceCalls:[],searchText:"",statusFilter:"Pending",isStatusFilterModalVisible:!1}},computed:Re(Re({},Object(k["c"])(["statistic","isWorker"])),{},{filteredServiceCalls:function(){var e=this;return this.serviceCalls.filter((function(t){var a,n,r,s;return((null===t||void 0===t||null===(a=t.store)||void 0===a?void 0:a.store_name.toLowerCase().includes(e.searchText.toLowerCase()))||(null===t||void 0===t||null===(n=t.store)||void 0===n?void 0:n.store_code.toLowerCase().includes(e.searchText.toLowerCase()))||(null===(r=t.store)||void 0===r||null===(r=r.route)||void 0===r||null===(r=r.teknisi)||void 0===r||null===(r=r.nickname)||void 0===r?void 0:r.toLowerCase().includes(e.searchText.toLowerCase()))||(null===t||void 0===t||null===(s=t.subject)||void 0===s?void 0:s.toLowerCase().includes(e.searchText.toLowerCase())))&&e.filterServiceCalls(t)}))}}),methods:{fetchServiceCalls:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,T.get("/service-call");case 4:return a=t.sent,e.serviceCalls=a.data,t.next=8,L("serviceCalls");case 8:return t.next=10,S("serviceCalls",e.serviceCalls);case 10:t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),r.a.$toast.error("Error fetching service calls:"),console.log("Error fetching service calls:",t.t0);case 16:return t.prev=16,e.loading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[1,12,16,19]])})))()},filterServiceCalls:function(e){return"Pending"===this.statusFilter?"pending"===e.status:"Progress"===this.statusFilter?"in_progress"===e.status:"Solved"!==this.statusFilter||"solved"===e.status},getStatusFilterColor:function(){switch(this.statusFilter){case"Pending":return"#ffebcc";case"Progress":return"#52e5ed";case"Solved":return"#d4f8d4";default:return"#fff"}},setStatusFilter:function(e){this.statusFilter=e,this.isStatusFilterModalVisible=!1},formatDate:function(e){return e.replace(/(\d{4})-(\d{2})-(\d{2})/,"$3/$2")},navigateToDetail:function(e){this.$router.push({name:"DetailServiceCall",params:{serviceCall:e,id:e.id}})},checkDataSC:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j("serviceCalls");case 2:if(a=t.sent,n=localStorage.getItem("lastUpdate_sc"),r=(new Date).getTime(),s=n&&r-n>144e5,a.length&&!s){t.next=12;break}return t.next=9,e.fetchServiceCalls();case 9:localStorage.setItem("lastUpdate_sc",r),t.next=13;break;case 12:e.serviceCalls=a;case 13:e.statistic.sc_count=e.serviceCalls.filter((function(e){return"pending"===e.status})).length;case 14:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.checkDataSC()}},Me=Te,Ae=(a("47ce"),Object(N["a"])(Me,De,Ie,!1,null,"3e6f1f29",null)),Ne=Ae.exports,Ee=function(){var e,t,a=this,n=a._self._c;return a.serviceCall?n("div",{staticClass:"container"},[n("header",{staticClass:"header"},[n("h1",[a._v(a._s(null===(e=a.serviceCall)||void 0===e||null===(e=e.store)||void 0===e?void 0:e.store_code)+" "+a._s(null===(t=a.serviceCall)||void 0===t||null===(t=t.store)||void 0===t?void 0:t.store_name))])]),a.isCompressing?n("div",{staticClass:"compressing-indicator"},[n("i",{staticClass:"fas fa-spinner fa-spin"}),a._v(" Mengompres gambar... ")]):a._e(),a.loading?n("div",{staticClass:"indicator"},[n("span",[a._v("Loading...")])]):n("div",[n("div",{staticClass:"content"},[n("div",{staticClass:"details"},[n("div",{staticClass:"detail-row"},[n("i",{staticClass:"fa fa-calendar"}),n("span",[a._v(a._s(a.formattedDate))])]),n("div",{staticClass:"detail-row"},[n("i",{staticClass:"fa fa-info-circle"}),n("span",[a._v(a._s(a.serviceCall.status))])]),n("div",{staticClass:"detail-row"},[n("i",{staticClass:"fa fa-phone"}),n("span",[a._v(a._s(a.serviceCall.pic))])]),n("div",{staticClass:"detail-row"},[n("i",{staticClass:"fa fa-file"}),n("span",[a._v(a._s(a.serviceCall.subject))])]),n("div",{staticClass:"detail-row"},[n("i",{staticClass:"fa fa-home"}),n("span",[a._v(a._s(a.serviceCall.store.address))])])]),a._l(a.lines,(function(e){return n("div",{key:e.id,staticClass:"line-container"},[n("h2",[a._v("Unit No: "+a._s(e.unit_no))]),n("h3",[a._v("Complain Details: "+a._s(e.complain_details))]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.trouble_causer,expression:"line.trouble_causer"}],staticClass:"input",attrs:{placeholder:"Penyebab",required:""},domProps:{value:e.trouble_causer},on:{input:function(t){t.target.composing||a.$set(e,"trouble_causer",t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.solution,expression:"line.solution"}],staticClass:"input",attrs:{placeholder:"Solusi",required:""},domProps:{value:e.solution},on:{input:function(t){t.target.composing||a.$set(e,"solution",t.target.value)}}}),n("div",{staticClass:"photo-container"},[n("button",{staticStyle:{"font-size":"x-large"},on:{click:function(t){return a.handleAddPhotos(e.id)}}},[n("i",{staticClass:"fa fa-camera"})]),a._l(e.photos,(function(e,t){return n("div",{key:t,staticClass:"photo-preview"},[e.url?n("img",{staticClass:"photo",attrs:{src:e.url}}):n("img",{staticClass:"photo",attrs:{src:e.uri}})])}))],2)])})),n("div",{staticClass:"button-container"},[n("button",{staticClass:"button cancel-button",on:{click:a.handleCancel}},[a._v("Batal")]),n("button",{staticClass:"button",on:{click:a.handleSave}},[a._v("Simpan")])])],2)])]):a._e()},qe=[];function $e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Be(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$e(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ze={data:function(){return{loading:!1,serviceCall:this.$route.params.serviceCall||null,lines:[],isCompressing:!1}},computed:{formattedDate:function(){var e;return this.formatDate(null===(e=this.serviceCall)||void 0===e?void 0:e.trx_date)}},created:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.serviceCall){t.next=6;break}return a=e.$route.params.id,t.next=4,e.fetchServiceCall(a);case 4:t.next=7;break;case 6:e.initializeLines(e.serviceCall.lines);case 7:case"end":return t.stop()}}),t)})))()},methods:{fetchServiceCall:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.prev=1,a.next=4,T.get("/service-call/detail/".concat(e));case 4:n=a.sent,t.serviceCall=n.data,t.initializeLines(t.serviceCall.lines),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](1),console.error("Error fetching service call:",a.t0),r.a.$toast.error("Error","Gagal memuat data service call.");case 13:return a.prev=13,t.loading=!1,a.finish(13);case 16:case"end":return a.stop()}}),a,null,[[1,9,13,16]])})))()},initializeLines:function(e){this.lines=e.map((function(e){return Be({},e)}))},formatDate:function(e){var t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},handleInputChange:function(e,t,a){this.lines=this.lines.map((function(n){return n.id===e?Be(Be({},n),{},Object(z["a"])({},t,a)):n}))},handleAddPhotos:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=document.createElement("input"),n.type="file",n.accept="image/*",n.multiple=!0,n.onchange=function(){var a=Object(h["a"])(regeneratorRuntime.mark((function a(n){var r,s,i,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.isCompressing=!0,r=n.target.files,s=[],i=regeneratorRuntime.mark((function a(){var n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=r[l],n instanceof Blob){a.next=4;break}return console.error("File bukan Blob atau File:",n),a.abrupt("return",0);case 4:return a.prev=4,a.next=7,t.readAndCompressImage(n);case 7:if(i=a.sent,o=new FileReader,i instanceof Blob){a.next=12;break}return console.error("Compressed file bukan Blob:",i),a.abrupt("return",0);case 12:o.onload=function(a){s.push({uri:a.target.result,file:i}),s.length===r.length&&(t.lines=t.lines.map((function(t){return t.id===e?Be(Be({},t),{},{photos:[].concat(Object(ge["a"])(t.photos),s)}):t})))},o.readAsDataURL(i),a.next=19;break;case 16:a.prev=16,a.t0=a["catch"](4),console.error("Error processing file:",a.t0);case 19:case"end":return a.stop()}}),a,null,[[4,16]])})),l=0;case 5:if(!(l<r.length)){a.next=13;break}return a.delegateYield(i(),"t0",7);case 7:if(o=a.t0,0!==o){a.next=10;break}return a.abrupt("continue",10);case 10:l++,a.next=5;break;case 13:t.isCompressing=!1;case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.click();case 6:case"end":return a.stop()}}),a)})))()},readAndCompressImage:function(e){var t=this;return new Promise((function(a,n){var s=new FileReader;e.type.startsWith("image/")?(s.onload=function(){var r=Object(h["a"])(regeneratorRuntime.mark((function r(s){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.compressImage(s.target.result,e.name);case 3:i=r.sent,console.log("Compressed Image:",i),a(i),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),n(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}(),s.onerror=function(e){return n(e)},s.readAsDataURL(e)):r.a.$toast.error("Hanya file gambar yang diperbolehkan.")}))},compressImage:function(e){return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new Image,a.src=e,t.abrupt("return",new Promise((function(e,t){a.onload=function(){var n=document.createElement("canvas"),r=n.getContext("2d"),s=800,i=a.width,o=a.height;i>o?i>s&&(o=Math.round(o*=s/i),i=s):o>s&&(i=Math.round(i*=s/o),o=s),n.width=i,n.height=o,r.drawImage(a,0,0,i,o);var l,c=.8;do{l=n.toDataURL("image/jpeg",c);for(var u=atob(l.split(",")[1]),d=new ArrayBuffer(u.length),m=new Uint8Array(d),p=0;p<u.length;p++)m[p]=u.charCodeAt(p);var f=new Blob([d],{type:"image/jpeg"});if(f.size<=204800)return void e(f);c-=.1}while(c>0);t("Failed to compress image below 200KB")},a.onerror=function(e){return t(e)}})));case 3:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,s,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,a=new FormData,a.append("sc_id",e.serviceCall.id),t.next=6,U();case 6:if(n=t.sent,s=n.position,s&&(a.append("latitude",null===s||void 0===s||null===(i=s.coords)||void 0===i?void 0:i.latitude),a.append("longitude",null===s||void 0===s||null===(o=s.coords)||void 0===o?void 0:o.longitude)),l=e.lines.every((function(e){return e.photos&&e.photos.length>0})),l){t.next=12;break}return t.abrupt("return",r.a.$toast.error("Setiap unit harus memiliki minimal satu foto."));case 12:if(c=e.lines.every((function(e){return e.solution})),c){t.next=15;break}return t.abrupt("return",r.a.$toast.error("Solusi tidak boleh kosong untuk setiap unit."));case 15:return e.lines.forEach((function(e,t){var n,r;e.photos.forEach((function(e){var n;e.file&&(a.append("lines[".concat(t,"][photos][]"),e.file),a.append("lines[".concat(t,"][filemtime][]"),null===e||void 0===e||null===(n=e.file)||void 0===n?void 0:n.lastModified))})),a.append("lines[".concat(t,"][solution]"),null!==(n=e.solution)&&void 0!==n?n:""),a.append("lines[".concat(t,"][trouble_causer]"),null!==(r=e.trouble_causer)&&void 0!==r?r:"")})),t.next=18,T.post("/service-call/update",a,{headers:{"Content-Type":"multipart/form-data"}});case 18:return u=t.sent,d=u.data,t.next=22,D("serviceCalls",e.serviceCall.id,d,"sc");case 22:r.a.$toast.success("Berhasil disimpan"),e.$router.push({name:"ServiceCall",params:{serviceCall:e.serviceCall}}),t.next=30;break;case 26:t.prev=26,t.t0=t["catch"](1),console.error("Error saving data:",t.t0),r.a.$toast.error("Error: "+JSON.stringify(t.t0));case 30:return t.prev=30,e.loading=!1,t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[1,26,30,33]])})))()},handleCancel:function(){this.$router.push({name:"ServiceCall",params:{serviceCall:this.serviceCall}})}}},Ue=ze,Ve=(a("ab6e"),Object(N["a"])(Ue,Ee,qe,!1,null,"33614caf",null)),Ke=Ve.exports,Je=function(){var e=this,t=e._self._c;return t("div",{staticClass:"menu-container"},[t("main",{staticClass:"menu-content"},[t("h2",[e._v("Menu")]),e._l(e.menus,(function(a,n){return t("div",{key:n,staticClass:"menu-item",on:{click:function(t){return e.goTo(a.route)}}},[t("i",{class:a.icon,style:{color:a.color}}),t("span",[e._v("  "+e._s(a.label))])])}))],2)])},He=[],Qe={data:function(){return{menus:[{label:"Operasional",icon:"fas fa-clipboard-list",route:"/operasional",color:"#4CAF50"},{label:"PO Material",icon:"fas fa-cubes",route:"/material",color:"#FF9800"},{label:"Alat / Asset",icon:"fas fa-wrench",route:"/tooling",color:"#2196F3"},{label:"Kasbon",icon:"fas fa-wallet",route:"/kasbon",color:"#9C27B0"},{label:"Profile",icon:"fas fa-user",route:"/profile",color:"#E91E63"},{label:"About",icon:"fas fa-info-circle",route:"/about",color:"#607D8B"},{label:"Setting",icon:"fas fa-cog",route:"/setting",color:"#FF5722"}]}},methods:{goTo:function(e){this.$router.push(e)}}},Ge=Qe,We=(a("5d0c"),Object(N["a"])(Ge,Je,He,!1,null,"7b12f20a",null)),Ye=We.exports,Xe=a("169a"),Ze=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"header-container"},[t("h2",{staticClass:"title"},[e._v("Daftar Operasional")]),t("i",{staticClass:"material-icons add-button",on:{click:e.handleAddButtonClick}},[e._v("add_circle")])]),e.loading?t("div",{staticClass:"loading-container"},[t("div",{staticClass:"spinner"})]):t("div",{staticClass:"container-box"},[e.operasionalData.length>0?e._l(e.operasionalData,(function(a,n){return t("OperasionalItem",{key:n,attrs:{operasional:a,onPress:e.handleItemClick}})})):t("p",{staticClass:"no-data-text"},[e._v("Tidak ada Data Operasional")])],2),t(Xe["a"],{attrs:{"max-width":"600"},model:{value:e.showDetails,callback:function(t){e.showDetails=t},expression:"showDetails"}},[e.selectedItem&&"approved"===e.selectedItem.status?t("OperasionalShowScreen",{attrs:{operasional:e.selectedItem},on:{close:e.closeDetails,"photo-uploaded":e.updateData}}):e._e()],1),t(Xe["a"],{attrs:{"max-width":"800"},model:{value:e.showEditForm,callback:function(t){e.showEditForm=t},expression:"showEditForm"}},[e.selectedItem&&"pending"===e.selectedItem.status?t("OperasionalEditForm",{attrs:{selectedOperasional:e.selectedItem,paramsFromServer:e.paramsFromServer,onSubmitCompleted:e.onSubmitCompleted},on:{close:e.closeDetails,submit:e.updateData}}):e._e()],1)],1)},et=[],tt=(a("20d6"),function(){var e,t=this,a=t._self._c;return a("div",{staticClass:"container",on:{click:function(e){return t.handleClick(t.operasional)}}},[a("div",{staticClass:"header"},[a("p",{staticClass:"no-ref"},[t._v("No. Ref: "+t._s(t.operasional.no_ref))]),a("p",{staticClass:"date"},[t._v(t._s(t.operasional.trx_date))])]),a("p",{staticClass:"pemohon"},[t._v("Pemohon: "+t._s((null===(e=t.operasional.pemohon)||void 0===e?void 0:e.nickname)||"-"))]),a("p",{staticClass:"ops-names"},[t._v("Nama Ops: "+t._s(t.opsNames))]),a("p",{staticClass:"note"},[t._v("Note: "+t._s(t.operasional.note||"-"))]),a("p",{staticClass:"total"},[t._v("Total Pengajuan: Rp"+t._s(t.formatCurrency(t.operasional.final_total)))]),a("p",{class:["status",t.operasional.status]},[t._v("Status: "+t._s(t.operasional.status))]),a("div",{staticClass:"payment-status-container"},[a("span",{domProps:{innerHTML:t._s(t.calculatePaymentStatus(t.operasional))}})])])}),at=[],nt=(a("6b54"),{props:["operasional","onPress"],computed:{opsNames:function(){return this.operasional.lines.map((function(e){return e.name.name})).join(" + ")}},methods:{handleClick:function(){this.onPress(this.operasional)},formatCurrency:function(e){var t=parseFloat(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");return e%1!==0?t.replace(".",","):t},calculatePaymentStatus:function(e){var t=e.payouts?e.payouts.reduce((function(e,t){return e+t.total_payment_amount}),0):0,a='<span style="padding: 5px;\n            border-radius: 5px;\n            color: #fff;\n            display: inline-block;background-color:warna;">value</span>';return e.biaya?parseInt(t)===parseInt(e.final_total)?a.replace(/warna/,"green").replace(/value/,"Lunas"):a.replace(/warna/,"blue").replace(/value/,"Sebagian (Rp".concat(this.formatCurrency(t),")</span>")):"approved"===e.status?a.replace(/warna/,"orange").replace(/value/,"Belum Dibayar"):""}}}),rt=nt,st=(a("0f60"),Object(N["a"])(rt,tt,at,!1,null,"5e27e58f",null)),it=st.exports,ot=a("8336"),lt=a("b0af"),ct=a("99d9"),ut=a("12b2"),dt=a("cc20"),mt=a("a523"),pt=a("ce7e"),ft=a("0e8f"),vt=a("132d"),ht=a("adda"),gt=a("a722"),bt=a("9910"),_t=function(){var e,t,a,n,r,s=this,i=s._self._c;return i(mt["a"],[i(lt["a"],{staticClass:"mx-auto elevation-2",attrs:{"max-width":"600"}},[i(ut["a"],{staticClass:"headline grey--text text--darken-2"},[s._v(" Detail Pengajuan Operasional ")]),i(pt["a"]),i(ct["b"],[i(gt["a"],{attrs:{row:"",wrap:""}},[i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("No Ref:")]),i("p",[s._v(s._s(s.operasional.no_ref))])]),i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Location:")]),i("p",[s._v(s._s((null===(e=s.operasional)||void 0===e||null===(e=e.location)||void 0===e?void 0:e.name)||"N/A"))])]),i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Operasional:")]),s._l(s.operasional.lines,(function(e,t){var a;return i(lt["a"],{key:t,staticClass:"ma-2 pa-2",attrs:{outlined:""}},[i("p",[i("strong",[s._v("Nama:")]),s._v(" "+s._s(null===(a=e.name)||void 0===a?void 0:a.name))]),i("p",[i("strong",[s._v("Qty:")]),s._v(" "+s._s(s.formatQuantity(e.qty)))]),i("p",[i("strong",[s._v("Nominal:")]),s._v(" "+s._s(s.formatNumber(e.nominal)))]),i("p",[i("strong",[s._v("Total:")]),s._v(" "+s._s(s.formatNumber(e.total_amount)))])])}))],2),i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Total Ops:")]),i("p",[s._v(s._s(s.formatNumber(null===(t=s.operasional)||void 0===t?void 0:t.final_total)))])]),null!==(a=s.operasional.for_store)&&void 0!==a&&a.length?i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Stores:")]),s._l(s.operasional.for_store,(function(e,t){return i(dt["a"],{key:t,staticClass:"ma-1",attrs:{small:""}},[s._v(" "+s._s(e.store_code)+" - "+s._s(e.store_name)+" ")])}))],2):s._e(),null!==(n=s.operasional.for_po)&&void 0!==n&&n.length?i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("PO (Delivery Order):")]),s._l(s.operasional.for_po,(function(e,t){return i(dt["a"],{key:t,staticClass:"ma-1",attrs:{small:""}},[s._v(" "+s._s(e.trx_no)+" ")])}))],2):s._e(),null!==(r=s.operasional.for_complain)&&void 0!==r&&r.length?i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Complains:")]),s._l(s.operasional.for_complain,(function(e,t){return i(dt["a"],{key:t,staticClass:"ma-1",attrs:{small:""}},[s._v(" "+s._s(e.trx_no)+" ")])}))],2):s._e(),s.operasional.note?i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Note:")]),i("p",[s._v(s._s(s.operasional.note))])]):s._e(),i(ft["a"],{attrs:{xs12:""}},[i("strong",[s._v("Lampiran:")]),i(gt["a"],{attrs:{row:"",wrap:""}},[i(ft["a"],{staticClass:"d-flex flex-column align-center",attrs:{xs4:""}},[i(ot["a"],{staticClass:"btn-custom",attrs:{outlined:"",small:""},on:{click:s.handleSelectImage}},[i(vt["a"],{attrs:{left:""}},[s._v("mdi-camera")])],1)],1),s._l(s.operasional.documents,(function(e,t){return i(ft["a"],{key:"existing-".concat(t),staticClass:"d-flex flex-column align-center",attrs:{xs4:""}},[i(ht["a"],{staticClass:"preview-thumbnail",attrs:{src:e.uri,"max-width":"80","max-height":"80"},on:{click:function(t){return s.handleImageClick(e.uri)}}})],1)})),s._l(s.selectedImages,(function(e,t){return i(ft["a"],{key:"new-".concat(t),staticClass:"d-flex flex-column align-center",attrs:{xs4:""}},[i(ht["a"],{staticClass:"preview-thumbnail",attrs:{src:e.uri,"max-width":"80","max-height":"80"},on:{click:function(t){return s.handleImageClick(e.uri)}}})],1)}))],2)],1)],1)],1),i(ct["a"],[i(ot["a"],{attrs:{block:"",color:"red",text:""},on:{click:s.onClose}},[s._v("Tutup")])],1),s.previewImage?i(Xe["a"],{attrs:{"max-width":"500",persistent:""},model:{value:s.previewImage,callback:function(e){s.previewImage=e},expression:"previewImage"}},[i(lt["a"],[i(ut["a"],{staticClass:"text-h5"},[i("span",[s._v("Lampiran Preview")]),i(bt["a"]),i(ot["a"],{attrs:{icon:""},on:{click:function(e){s.previewImage=null}}},[i(vt["a"],[s._v("mdi-close")])],1)],1),i(ct["b"],[i(ht["a"],{attrs:{src:s.previewImage,"max-height":"500","max-width":"100%"}})],1)],1)],1):s._e()],1)],1)},kt=[],Ct={props:["operasional","onSubmitCompleted"],setup:function(e,t){var a=t.emit,s=Object(n["ref"])([]),i=Object(n["ref"])(null),o=function(){a("close")},l=function(e){return e%1===0?c(e):e.toLocaleString()},c=function(e){return parseFloat(e).toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0})},u=function(e){return e=parseFloat(e)||0,e%1===0?e.toFixed(0):e.toFixed(2)},d=function(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.target.files[0],!a){e.next=4;break}return e.next=4,m(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.click()},m=function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(a){var n,s,i,o,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=new FormData,n.append("photo",a),n.append("ops_id",e.operasional.id),t.prev=3,t.next=6,T.post("/operasional/upload-photos",n,{headers:{"Content-Type":"multipart/form-data"}});case 6:s=t.sent,i=s.data||{},o=i.success,l=i.msg,c=i.id,o?(null===(u=r.a.$toast)||void 0===u||u.success(l||"Data berhasil disimpan."),d=URL.createObjectURL(a),e.operasional.documents=[].concat(Object(ge["a"])(e.operasional.documents||[]),[{uri:d,id:c}])):alert(l||"Data tidak disimpan."),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](3),alert("Error: Something went wrong during the upload."),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}(),p=function(e){i.value=e};return{selectedImages:s,previewImage:i,formatNumber:l,formatCurrency:c,formatQuantity:u,handleSelectImage:d,uploadImage:m,handleImageClick:p,onClose:o}}},wt=Ct,yt=(a("54b8"),Object(N["a"])(wt,_t,kt,!1,null,"57256ccc",null)),xt=yt.exports,Ot=a("8860"),Pt=a("ba95"),St=a("5d23"),jt=a("490a"),Lt=a("b56d"),Dt=a("2677"),It=a("a844"),Ft=a("3835"),Rt=(a("ffc1"),function(){var e,t=this,a=t._self._c;return a("div",{staticClass:"operasional-form"},[a(mt["a"],[a(lt["a"],{staticClass:"mx-auto elevation-4",attrs:{"max-width":"600",outlined:""}},[a(ut["a"],{staticClass:"text-h5 text-center"},[t._v("Pengajuan Operasional")]),a(pt["a"]),a(ct["b"],[a("div",{staticClass:"section"},[a(Lt["a"],{staticClass:"location-select",attrs:{items:Object.entries(t.location).map((function(e){var t=Object(Ft["a"])(e,2),a=t[0],n=t[1];return{id:a,name:n}})),"item-value":"id","item-text":"name",label:"Pilih Lokasi",outlined:"",dense:""},model:{value:t.selectedLocation,callback:function(e){t.selectedLocation=e},expression:"selectedLocation"}})],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary","text-color":"blue darken-3",outlined:""},on:{click:function(e){t.showOpsPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Tambah Ops ")],1),a(Xe["a"],{attrs:{"max-width":"500",transition:"dialog-bottom-transition"},model:{value:t.showOpsPicker,callback:function(e){t.showOpsPicker=e},expression:"showOpsPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Operasional")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Ops...",solo:""},model:{value:t.opsSearch,callback:function(e){t.opsSearch=e},expression:"opsSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredOpsList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleOpsChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredOpsList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Ops tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showOpsPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedOpsList.length>0?a(gt["a"],{staticClass:"selected-ops-list",attrs:{row:"",wrap:""}},t._l(t.selectedOpsList,(function(e,n){var r;return a(ft["a"],{key:n,staticClass:"selected-ops-item",attrs:{xs12:""}},[a(lt["a"],{staticClass:"pa-3 mb-2",attrs:{elevation:"2"}},[a("p",{staticClass:"font-weight-bold"},[t._v(t._s(e.name))]),(null===(r=e.ops_master_budget)||void 0===r?void 0:r.price)>0?a(Dt["a"],{attrs:{value:e.ops_master_budget.price,label:"Nominal",readonly:"",dense:"",outlined:""}}):a(Dt["a"],{attrs:{label:"Nominal",type:"number",dense:"",outlined:""},on:{input:function(e){return t.handleNominalChange(n,e)}},model:{value:e.nominal,callback:function(a){t.$set(e,"nominal",a)},expression:"ops.nominal"}}),a(Dt["a"],{attrs:{label:"Qty",type:"number",max:10,dense:"",outlined:""},on:{input:function(e){return t.handleQtyChange(n,e)}},model:{value:e.qty,callback:function(a){t.$set(e,"qty",a)},expression:"ops.qty"}}),a("p",{staticClass:"text-body-2 font-weight-light total"},[t._v("Total: "+t._s(e.total))]),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveOps(n)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1)],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showStorePicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Toko ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showStorePicker,callback:function(e){t.showStorePicker=e},expression:"showStorePicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Toko")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Toko...",solo:""},model:{value:t.storeSearch,callback:function(e){t.storeSearch=e},expression:"storeSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredStoreList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleStoreChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredStoreList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Toko tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showStorePicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedStoreList.length>0?a(gt["a"],{staticClass:"selected-store-list",attrs:{row:"",wrap:""}},t._l(t.selectedStoreList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemoveStore(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showPoPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" DO (PO) ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showPoPicker,callback:function(e){t.showPoPicker=e},expression:"showPoPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih DO (PO)")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari DO...",solo:""},model:{value:t.poSearch,callback:function(e){t.poSearch=e},expression:"poSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredPoList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handlePoChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredPoList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("DO tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showPoPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedPoList.length>0?a(gt["a"],{staticClass:"selected-po-list",attrs:{row:"",wrap:""}},t._l(t.selectedPoList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemovePo(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showComplainPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Complain ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showComplainPicker,callback:function(e){t.showComplainPicker=e},expression:"showComplainPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Complain")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Complain...",solo:""},model:{value:t.complainSearch,callback:function(e){t.complainSearch=e},expression:"complainSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredComplainList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleComplainChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredComplainList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Complain tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showComplainPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedComplainList.length>0?a(gt["a"],{staticClass:"selected-complain-list",attrs:{row:"",wrap:""}},t._l(t.selectedComplainList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemoveComplain(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a(It["a"],{attrs:{rows:"3",label:"Catatan",outlined:"",dense:""},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:t.triggerFileInput}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-attachment")]),t._v(" Lampirkan Foto ")],1),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},on:{change:t.handleFileUpload}}),t.previewImages.length>0?a(gt["a"],{staticClass:"files-container mt-2"},t._l(t.previewImages,(function(e,n){return a(ft["a"],{key:n,staticClass:"file-item",attrs:{cols:"4"}},[a(ht["a"],{staticClass:"file-thumbnail",attrs:{src:e.data,width:"80",height:"80"},on:{click:function(a){return t.openFullScreen(e,n)}}}),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveFile(n)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1)],1)})),1):t._e(),a(Xe["a"],{attrs:{"max-width":"600"},model:{value:t.isFullScreen,callback:function(e){t.isFullScreen=e},expression:"isFullScreen"}},[a(lt["a"],[a(ht["a"],{attrs:{src:null===(e=t.currentImage)||void 0===e?void 0:e.data,"max-height":"500"}}),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveFile(t.currentIndex)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.isFullScreen=!1}}},[t._v("Tutup")])],1)],1)],1),a(gt["a"],{staticClass:"mt-4",attrs:{row:"",wrap:"","align-center":"","justify-space-between":""}},[a(ot["a"],{staticClass:"btn-delete",attrs:{color:"red",large:""},on:{click:t.handleDelete}},[t._v(" Hapus ")]),a(ot["a"],{staticClass:"btn-update",staticStyle:{"background-color":"blue",color:"aliceblue"},attrs:{color:"success",large:""},on:{click:t.handleSubmit}},[t._v(" Perbarui ")])],1),t.error?a("p",{staticClass:"error-text mt-2"},[t._v(t._s(t.error))]):t._e()],1)],1)],1),t.loading?a(mt["a"],{staticClass:"d-flex justify-center align-center"},[a(jt["a"],{attrs:{indeterminate:"",color:"primary",size:"70"}})],1):t._e()],1)}),Tt=[];a("7514");function Mt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function At(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Nt={props:["selectedOperasional","onSubmitCompleted"],data:function(){var e,t,a;return{opsList:[],selectedOpsList:(null===(e=this.selectedOperasional)||void 0===e||null===(e=e.lines)||void 0===e?void 0:e.map((function(e){var t,a;return{id:null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.id,name:null===e||void 0===e||null===(a=e.name)||void 0===a?void 0:a.name,nominal:Math.round(null===e||void 0===e?void 0:e.nominal)||0,qty:parseInt(null===e||void 0===e?void 0:e.qty)||1}})))||[],showOpsPicker:!1,storeList:[],selectedStoreList:[],showStorePicker:!1,poList:[],selectedPoList:[],showPoPicker:!1,complainList:[],selectedComplainList:[],showComplainPicker:!1,location:{},selectedLocation:"",note:(null===(t=this.selectedOperasional)||void 0===t?void 0:t.note)||"",files:(null===(a=this.selectedOperasional)||void 0===a?void 0:a.documents)||[],error:"",opsSearch:"",storeSearch:"",poSearch:"",complainSearch:"",isCompressing:!1,previewImages:this.selectedOperasional.documents.map((function(e){return{data:e.uri||e.url,name:e.name||"Image",id:e.id,file:null}}))||[],isFullScreen:!1,currentImage:null,currentIndex:null,loading:!1}},computed:{filteredOpsList:function(){var e=this;return this.opsList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.opsSearch.toLowerCase())}))},filteredStoreList:function(){var e=this;return this.storeList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.storeSearch.toLowerCase())}))},filteredPoList:function(){var e=this;return this.poList.filter((function(t){return t.name.toLowerCase().includes(e.poSearch.toLowerCase())}))},filteredComplainList:function(){var e=this;return this.complainList.filter((function(t){return t.name.toLowerCase().includes(e.complainSearch.toLowerCase())}))}},methods:{triggerFileInput:function(){this.$refs.fileInput.click()},fetchFormOperasional:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional/getOpsFormData");case 3:a=t.sent,e.paramsFromServer=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error fetching form operasional",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},handleLocationChange:function(e){this.selectedLocation=e},handleOpsChange:function(e){if(!this.selectedOpsList.some((function(t){return t.name===e}))){var t,a=this.opsList.find((function(t){return t.name===e})),n=(null===a||void 0===a||null===(t=a.ops_master_budget)||void 0===t?void 0:t.price)||(null===a||void 0===a?void 0:a.nominal)||0;this.selectedOpsList.push(At(At({},a),{},{qty:1,nominal:n,total:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)}))}this.showOpsPicker=!1,this.opsSearch=""},handleStoreChange:function(e){if(e&&!this.selectedStoreList.some((function(t){return t.name===e}))){var t=this.storeList.find((function(t){return t.name===e}));t&&this.selectedStoreList.push(At({},t))}this.showStorePicker=!1,this.storeSearch=""},handleQtyChange:function(e,t){var a=10;if(t>a)return this.selectedOpsList[e].qty=a,void alert("Qty tidak boleh melebihi 10");this.selectedOpsList[e].qty=parseInt(t)||0;var n=this.selectedOpsList[e].qty*this.selectedOpsList[e].nominal;this.selectedOpsList[e].total=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)},handleNominalChange:function(e,t){this.selectedOpsList[e].nominal=parseFloat(t)||0;var a=this.selectedOpsList[e].qty*this.selectedOpsList[e].nominal;this.selectedOpsList[e].total=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)},handlePoChange:function(e){if(!this.selectedPoList.some((function(t){return t.name===e}))){var t=this.poList.find((function(t){return t.name===e}));this.selectedPoList.push(t)}this.showPoPicker=!1,this.poSearch=""},handleRemovePo:function(e){this.selectedPoList.splice(e,1)},handleComplainChange:function(e){if(!this.selectedComplainList.some((function(t){return t.name===e}))){var t=this.complainList.find((function(t){return t.name===e}));this.selectedComplainList.push(t)}this.showComplainPicker=!1,this.complainSearch=""},handleRemoveComplain:function(e){this.selectedComplainList.splice(e,1)},formatFileSize:function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(0)+" "+["B","kB","MB","GB","TB"][t]},handleFileUpload:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=Array.from(e.target.files),t.isCompressing=!0,a.prev=2,a.next=5,Promise.all(n.map((function(e){return t.readAndCompressImage(e)})));case 5:s=a.sent,(r=t.previewImages).push.apply(r,Object(ge["a"])(s));case 7:return a.prev=7,t.isCompressing=!1,a.finish(7);case 10:case"end":return a.stop()}}),a,null,[[2,,7,10]])})))()},readAndCompressImage:function(e){var t=this;return new Promise((function(a,n){if(!e.type.startsWith("image/"))return t.$toast.error("Hanya file gambar yang diperbolehkan."),n(new Error("Invalid file type"));var r=new FileReader;r.onload=function(){var r=Object(h["a"])(regeneratorRuntime.mark((function r(s){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.compressImage(s.target.result,e.name);case 3:i=r.sent,a(i),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),n(r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e){return r.apply(this,arguments)}}(),r.onerror=function(e){return n(e)},r.readAsDataURL(e)}))},compressImage:function(e,t){return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Image,n.src=e,a.abrupt("return",new Promise((function(e,a){n.onload=function(){var r=document.createElement("canvas"),s=r.getContext("2d"),i=800,o=n.width,l=n.height;o>l?o>i&&(l=Math.round(l*=i/o),o=i):l>i&&(o=Math.round(o*=i/l),l=i),r.width=o,r.height=l,s.drawImage(n,0,0,o,l);var c,u=.8;do{c=r.toDataURL("image/jpeg",u);for(var d=atob(c.split(",")[1]),m=new ArrayBuffer(d.length),p=new Uint8Array(m),f=0;f<d.length;f++)p[f]=d.charCodeAt(f);var v=new Blob([m],{type:"image/jpeg"});if(v.size<=204800)return void e({name:t,data:c,file:v,filemtime:Date.now(),size:v.size});u-=.1}while(u>0);a("Failed to compress image below 200KB")},n.onerror=function(e){return a(e)}})));case 3:case"end":return a.stop()}}),a)})))()},openFullScreen:function(e,t){this.currentImage=e,this.currentIndex=t,this.isFullScreen=!0},handleRemoveFile:function(e){this.previewImages.splice(e,1)},handleRemoveOps:function(e){this.selectedOpsList.splice(e,1)},handleRemoveStore:function(e){this.selectedStoreList.splice(e,1)},handleDelete:function(){var e=this;confirm("Apakah Anda yakin ingin menghapus Pengajuan ini?")&&(this.loading=!0,T.delete("/operasional/".concat(this.selectedOperasional.id)).then((function(t){console.log("Data berhasil dihapus",t.data),e.onSubmitCompleted(At(At({},t.data),{},{remove:e.selectedOperasional.id}))})).catch((function(e){return console.error("Error deleting data:",e)})).finally((function(){e.loading=!1})))},handleSubmit:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.selectedOpsList.length){t.next=3;break}return e.error="Harap tambahkan minimal satu nama Ops",t.abrupt("return");case 3:if(!e.selectedOpsList.some((function(e){return e.nominal<1e3}))){t.next=6;break}return e.error="Nominal tidak boleh kurang dari 1000",t.abrupt("return");case 6:return n=e.selectedOpsList.reduce((function(e,t){return e+t.qty*t.nominal}),0),e.error="",r=new FormData,r.append("id",null===(a=e.selectedOperasional)||void 0===a?void 0:a.id),r.append("location_id",e.selectedLocation),r.append("ops",JSON.stringify(e.selectedOpsList)),r.append("stores",e.selectedStoreList.map((function(e){return e.id}))),r.append("pos",e.selectedPoList.map((function(e){return e.id}))),r.append("complains",e.selectedComplainList.map((function(e){return e.id}))),r.append("final_total",n),r.append("note",e.note),e.previewImages.forEach((function(e,t){e.file?e.file&&r.append("files[".concat(t,"]"),e.file,e.name):r.append("existing_images[".concat(t,"]"),e.id)})),t.prev=18,e.loading=!0,t.next=22,T.post("/operasional/update-ops-form-data",r,{headers:{"Content-Type":"multipart/form-data"}});case 22:s=t.sent,i=s.data,null!==i&&void 0!==i&&i.success?setTimeout((function(){e.onSubmitCompleted(At({},i))}),1e3):(null===(o=e.$toast)||void 0===o||o.error((null===i||void 0===i?void 0:i.msg)||"Ada kesalahan cek, console.warn"),console.log(i)),t.next=30;break;case 27:t.prev=27,t.t0=t["catch"](18),console.error(t.t0);case 30:return t.prev=30,e.loading=!1,t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[18,27,30,33]])})))()},fetchParamsFromServer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional/getOpsFormData");case 3:a=t.sent,e.initializeData(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Gagal mengambil data dari server:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},initializeData:function(e){var t,a,n,r,s,i,o;this.opsList=e.opsNames||[],this.storeList=e.stores||[],this.poList=e.poList||[],this.complainList=e.complains||[],this.location=e.locations||{},this.selectedLocation=(null===(t=this.selectedOperasional)||void 0===t?void 0:t.location_id)||Object.keys(e.locations||[])[0];var l=(null===(a=this.selectedOperasional)||void 0===a||null===(a=a.for_store)||void 0===a?void 0:a.map((function(e){return e.id})))||[];this.selectedStoreList=(null===(n=e.stores)||void 0===n?void 0:n.filter((function(e){return l.includes(e.id)})))||[];var c=(null===(r=this.selectedOperasional)||void 0===r||null===(r=r.for_po)||void 0===r?void 0:r.map((function(e){return e.id})))||[];this.selectedPoList=(null===(s=e.poList)||void 0===s?void 0:s.filter((function(e){return c.includes(e.id)})))||[];var u=(null===(i=this.selectedOperasional)||void 0===i||null===(i=i.for_complain)||void 0===i?void 0:i.map((function(e){return e.id})))||[];this.selectedComplainList=(null===(o=e.complains)||void 0===o?void 0:o.filter((function(e){return u.includes(e.id)})))||[]}},created:function(){null===this||void 0===this||this.fetchParamsFromServer()},mounted:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(null===e||void 0===e?void 0:e.selectedOperasional),e.selectedOpsList.forEach((function(t,a){e.handleNominalChange(a,t.nominal)}));case 2:case"end":return t.stop()}}),t)})))()}},Et=Nt,qt=(a("fedb"),Object(N["a"])(Et,Rt,Tt,!1,null,"72caf4e8",null)),$t=qt.exports,Bt={components:{OperasionalItem:it,OperasionalShowScreen:xt,OperasionalEditForm:$t},data:function(){return{operasionalData:[],loading:!0,formVisible:!1,paramsFromServer:{},showDetails:!1,showEditForm:!1,selectedItem:null}},methods:{fetchOperasional:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional");case 3:a=t.sent,e.operasionalData=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error(t.t0);case 10:return t.prev=10,e.loading=!1,t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[0,7,10,13]])})))()},fetchFormOperasional:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional/getOpsFormData");case 3:a=t.sent,e.paramsFromServer=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error fetching form operasional",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},handleAddButtonClick:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Object.keys(e.paramsFromServer).length){t.next=4;break}return e.loading=!0,t.next=4,e.fetchFormOperasional().then((function(){e.loading=!1}));case 4:e.$router.push({name:"OperasionalForm",params:{paramsFromServer:e.paramsFromServer}});case 5:case"end":return t.stop()}}),t)})))()},handleItemClick:function(e){this.selectedItem=e,"approved"===e.status?this.showDetails=!0:"pending"===e.status&&(this.showEditForm=!0)},closeDetails:function(){this.showDetails=!1,this.showEditForm=!1,this.selectedItem=null},updateData:function(e){var t=this.operasionalData.findIndex((function(t){return t.id===e.id}));-1!==t&&this.operasionalData.splice(t,1,e),this.closeDetails()},setLoading:function(e){this.loading=e},onSubmitCompleted:function(e){e.success?(this.fetchOperasional(),this.$toast.success(e.msg||"Data berhasil disimpan.")):this.$toast.error(e.msg||"Terjadi kesalahan. Silakan coba lagi."),this.closeDetails()}},created:function(){this.fetchOperasional()}},zt=Bt,Ut=(a("2d92"),Object(N["a"])(zt,Ze,et,!1,null,"8a31e68a",null)),Vt=Ut.exports,Kt=function(){var e,t=this,a=t._self._c;return a("div",{staticClass:"operasional-form"},[a(mt["a"],[a(lt["a"],{staticClass:"mx-auto elevation-4",attrs:{"max-width":"600",outlined:""}},[a(ut["a"],{staticClass:"text-h5 text-center"},[t._v("Pengajuan Operasional")]),a(pt["a"]),a(ct["b"],[a("div",{staticClass:"section"},[a(Lt["a"],{staticClass:"location-select",attrs:{items:Object.entries(t.location).map((function(e){var t=Object(Ft["a"])(e,2),a=t[0],n=t[1];return{id:a,name:n}})),"item-value":"id","item-text":"name",label:"Pilih Lokasi",outlined:"",dense:""},model:{value:t.selectedLocation,callback:function(e){t.selectedLocation=e},expression:"selectedLocation"}})],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary","text-color":"blue darken-3",outlined:""},on:{click:function(e){t.showOpsPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Tambah Ops ")],1),a(Xe["a"],{attrs:{"max-width":"500",transition:"dialog-bottom-transition"},model:{value:t.showOpsPicker,callback:function(e){t.showOpsPicker=e},expression:"showOpsPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Operasional")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Ops...",solo:""},model:{value:t.opsSearch,callback:function(e){t.opsSearch=e},expression:"opsSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredOpsList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleOpsChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredOpsList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Ops tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showOpsPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedOpsList.length>0?a(gt["a"],{staticClass:"selected-ops-list",attrs:{row:"",wrap:""}},t._l(t.selectedOpsList,(function(e,n){var r;return a(ft["a"],{key:n,staticClass:"selected-ops-item",attrs:{xs12:""}},[a(lt["a"],{staticClass:"pa-3 mb-2",attrs:{elevation:"2"}},[a("p",{staticClass:"font-weight-bold"},[t._v(t._s(e.name))]),(null===(r=e.ops_master_budget)||void 0===r?void 0:r.price)>0?a(Dt["a"],{attrs:{value:e.ops_master_budget.price,label:"Nominal",readonly:"",dense:"",outlined:""}}):a(Dt["a"],{attrs:{label:"Nominal",type:"number",dense:"",outlined:""},on:{input:function(e){return t.handleNominalChange(n,e)}},model:{value:e.nominal,callback:function(a){t.$set(e,"nominal",a)},expression:"ops.nominal"}}),a(Dt["a"],{attrs:{label:"Qty",type:"number",dense:"",outlined:""},on:{input:function(e){return t.handleQtyChange(n,e)}},model:{value:e.qty,callback:function(a){t.$set(e,"qty",a)},expression:"ops.qty"}}),a("p",{staticClass:"text-body-2 font-weight-light total"},[t._v("Total: "+t._s(e.total))]),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveOps(n)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1)],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showStorePicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Toko ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showStorePicker,callback:function(e){t.showStorePicker=e},expression:"showStorePicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Toko")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Toko...",solo:""},model:{value:t.storeSearch,callback:function(e){t.storeSearch=e},expression:"storeSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredStoreList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleStoreChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredStoreList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Toko tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showStorePicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedStoreList.length>0?a(gt["a"],{staticClass:"selected-store-list",attrs:{row:"",wrap:""}},t._l(t.selectedStoreList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemoveStore(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showPoPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" DO (PO) ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showPoPicker,callback:function(e){t.showPoPicker=e},expression:"showPoPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih DO (PO)")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari DO...",solo:""},model:{value:t.poSearch,callback:function(e){t.poSearch=e},expression:"poSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredPoList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handlePoChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredPoList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("DO tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showPoPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedPoList.length>0?a(gt["a"],{staticClass:"selected-po-list",attrs:{row:"",wrap:""}},t._l(t.selectedPoList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemovePo(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a("div",{staticClass:"section"},[a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(e){t.showComplainPicker=!0}}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-plus-circle")]),t._v(" Complain ")],1),a(Xe["a"],{attrs:{"max-width":"500"},model:{value:t.showComplainPicker,callback:function(e){t.showComplainPicker=e},expression:"showComplainPicker"}},[a(lt["a"],[a(ut["a"],{staticClass:"text-h6"},[t._v("Pilih Complain")]),a(pt["a"]),a(ct["b"],[a(Dt["a"],{attrs:{placeholder:"Cari Complain...",solo:""},model:{value:t.complainSearch,callback:function(e){t.complainSearch=e},expression:"complainSearch"}}),a(Ot["a"],{attrs:{dense:""}},[t._l(t.filteredComplainList,(function(e,n){return a(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(a){return t.handleComplainChange(e.name)}}},[a(St["a"],[a(St["c"],[t._v(t._s(e.name))])],1)],1)})),0===t.filteredComplainList.length?a(Pt["a"],[a(St["a"],[a(St["c"],[t._v("Complain tidak ditemukan")])],1)],1):t._e()],2)],1),a(pt["a"]),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.showComplainPicker=!1}}},[t._v("Tutup")])],1)],1)],1),t.selectedComplainList.length>0?a(gt["a"],{staticClass:"selected-complain-list",attrs:{row:"",wrap:""}},t._l(t.selectedComplainList,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:""}},[a(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[t._v(" "+t._s(e.name)+" "),a(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(e){return t.handleRemoveComplain(n)}}},[t._v("mdi-close-circle")])],1)],1)})),1):t._e()],1),a(It["a"],{attrs:{rows:"3",label:"Catatan",outlined:"",dense:""},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),a(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:t.triggerFileInput}},[a(vt["a"],{attrs:{left:""}},[t._v("mdi-attachment")]),t._v(" Lampirkan Foto ")],1),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},on:{change:t.handleFileUpload}}),t.previewImages.length>0?a(gt["a"],{staticClass:"files-container mt-2"},t._l(t.previewImages,(function(e,n){return a(ft["a"],{key:n,staticClass:"file-item",attrs:{cols:"4"}},[a(ht["a"],{staticClass:"file-thumbnail",attrs:{src:e.data,width:"80",height:"80"},on:{click:function(a){return t.openFullScreen(e,n)}}}),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveFile(n)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1)],1)})),1):t._e(),a(Xe["a"],{attrs:{"max-width":"600"},model:{value:t.isFullScreen,callback:function(e){t.isFullScreen=e},expression:"isFullScreen"}},[a(lt["a"],[a(ht["a"],{attrs:{src:null===(e=t.currentImage)||void 0===e?void 0:e.data,"max-height":"500"}}),a(ct["a"],[a(bt["a"]),a(ot["a"],{attrs:{icon:"",small:""},on:{click:function(e){return t.handleRemoveFile(t.currentIndex)}}},[a(vt["a"],{attrs:{color:"red"}},[t._v("mdi-delete")])],1),a(ot["a"],{attrs:{text:""},on:{click:function(e){t.isFullScreen=!1}}},[t._v("Tutup")])],1)],1)],1),a(ot["a"],{staticClass:"mt-4 btn-submit",staticStyle:{"background-color":"blue",color:"aliceblue"},attrs:{color:"success",block:"",large:""},on:{click:t.handleSubmit}},[t._v("Ajukan")]),t.error?a("p",{staticClass:"error-text mt-2"},[t._v(t._s(t.error))]):t._e()],1)],1)],1),t.loading?a(mt["a"],{staticClass:"d-flex justify-center align-center"},[a(jt["a"],{attrs:{indeterminate:"",color:"primary",size:"70"}})],1):t._e()],1)},Jt=[];function Ht(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Qt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ht(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Gt={props:["paramsFromServer"],data:function(){return{opsList:[],selectedOpsList:[],showOpsPicker:!1,storeList:[],selectedStoreList:[],showStorePicker:!1,poList:[],selectedPoList:[],showPoPicker:!1,complainList:[],selectedComplainList:[],showComplainPicker:!1,location:{},selectedLocation:"",note:"",files:[],error:"",opsSearch:"",storeSearch:"",poSearch:"",complainSearch:"",isCompressing:!1,previewImages:[],isFullScreen:!1,currentImage:null,currentIndex:null,loading:!1}},computed:{filteredOpsList:function(){var e=this;return this.opsList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.opsSearch.toLowerCase())}))},filteredStoreList:function(){var e=this;return this.storeList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.storeSearch.toLowerCase())}))},filteredPoList:function(){var e=this;return this.poList.filter((function(t){return t.name.toLowerCase().includes(e.poSearch.toLowerCase())}))},filteredComplainList:function(){var e=this;return this.complainList.filter((function(t){return t.name.toLowerCase().includes(e.complainSearch.toLowerCase())}))}},methods:{triggerFileInput:function(){this.$refs.fileInput.click()},fetchFormOperasional:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional/getOpsFormData");case 3:a=t.sent,e.paramsFromServer=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error fetching form operasional",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},handleLocationChange:function(e){this.selectedLocation=e},handleOpsChange:function(e){if(!this.selectedOpsList.some((function(t){return t.name===e}))){var t,a=this.opsList.find((function(t){return t.name===e})),n=(null===a||void 0===a||null===(t=a.ops_master_budget)||void 0===t?void 0:t.price)||0;this.selectedOpsList.push(Qt(Qt({},a),{},{qty:1,nominal:n,total:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)}))}this.showOpsPicker=!1,this.opsSearch=""},handleStoreChange:function(e){if(e&&!this.selectedStoreList.some((function(t){return t.name===e}))){var t=this.storeList.find((function(t){return t.name===e}));t&&this.selectedStoreList.push(Qt({},t))}this.showStorePicker=!1,this.storeSearch=""},handleQtyChange:function(e,t){var a=10;if(t>a)return this.selectedOpsList[e].qty=a,void alert("Qty tidak boleh melebihi 10");this.selectedOpsList[e].qty=parseInt(t)||0;var n=this.selectedOpsList[e].qty*this.selectedOpsList[e].nominal;this.selectedOpsList[e].total=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)},handleNominalChange:function(e,t){this.selectedOpsList[e].nominal=parseFloat(t)||0;var a=this.selectedOpsList[e].qty*this.selectedOpsList[e].nominal;this.selectedOpsList[e].total=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)},handlePoChange:function(e){if(!this.selectedPoList.some((function(t){return t.name===e}))){var t=this.poList.find((function(t){return t.name===e}));this.selectedPoList.push(t)}this.showPoPicker=!1,this.poSearch=""},handleRemovePo:function(e){this.selectedPoList.splice(e,1)},handleComplainChange:function(e){if(!this.selectedComplainList.some((function(t){return t.name===e}))){var t=this.complainList.find((function(t){return t.name===e}));this.selectedComplainList.push(t)}this.showComplainPicker=!1,this.complainSearch=""},handleRemoveComplain:function(e){this.selectedComplainList.splice(e,1)},formatFileSize:function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(0)+" "+["B","kB","MB","GB","TB"][t]},handleFileUpload:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=Array.from(e.target.files),t.isCompressing=!0,a.prev=2,a.next=5,Promise.all(n.map((function(e){return t.readAndCompressImage(e)})));case 5:s=a.sent,(r=t.previewImages).push.apply(r,Object(ge["a"])(s));case 7:return a.prev=7,t.isCompressing=!1,a.finish(7);case 10:case"end":return a.stop()}}),a,null,[[2,,7,10]])})))()},readAndCompressImage:function(e){var t=this;return new Promise((function(a,n){if(!e.type.startsWith("image/"))return t.$toast.error("Hanya file gambar yang diperbolehkan."),n(new Error("Invalid file type"));var r=new FileReader;r.onload=function(){var r=Object(h["a"])(regeneratorRuntime.mark((function r(s){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.compressImage(s.target.result,e.name);case 3:i=r.sent,a(i),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),n(r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e){return r.apply(this,arguments)}}(),r.onerror=function(e){return n(e)},r.readAsDataURL(e)}))},compressImage:function(e,t){return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Image,n.src=e,a.abrupt("return",new Promise((function(e,a){n.onload=function(){var r=document.createElement("canvas"),s=r.getContext("2d"),i=800,o=n.width,l=n.height;o>l?o>i&&(l=Math.round(l*=i/o),o=i):l>i&&(o=Math.round(o*=i/l),l=i),r.width=o,r.height=l,s.drawImage(n,0,0,o,l);var c,u=.8;do{c=r.toDataURL("image/jpeg",u);for(var d=atob(c.split(",")[1]),m=new ArrayBuffer(d.length),p=new Uint8Array(m),f=0;f<d.length;f++)p[f]=d.charCodeAt(f);var v=new Blob([m],{type:"image/jpeg"});if(v.size<=204800)return void e({name:t,data:c,file:v,filemtime:Date.now(),size:v.size});u-=.1}while(u>0);a("Failed to compress image below 200KB")},n.onerror=function(e){return a(e)}})));case 3:case"end":return a.stop()}}),a)})))()},openFullScreen:function(e,t){this.currentImage=e,this.currentIndex=t,this.isFullScreen=!0},handleRemoveFile:function(e){this.previewImages.splice(e,1)},handleRemoveOps:function(e){this.selectedOpsList.splice(e,1)},handleRemoveStore:function(e){this.selectedStoreList.splice(e,1)},handleSubmit:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.selectedOpsList.length){t.next=3;break}return e.error="Harap tambahkan minimal satu nama Ops",t.abrupt("return");case 3:if(!e.selectedOpsList.some((function(e){return e.nominal<1e3}))){t.next=6;break}return e.error="Nominal tidak boleh kurang dari 1000",t.abrupt("return");case 6:return a=e.selectedOpsList.reduce((function(e,t){return e+t.qty*t.nominal}),0),e.error="",n=new FormData,n.append("location_id",e.selectedLocation),n.append("ops",JSON.stringify(e.selectedOpsList)),n.append("stores",e.selectedStoreList.map((function(e){return e.id}))),n.append("pos",e.selectedPoList.map((function(e){return e.id}))),n.append("complains",e.selectedComplainList.map((function(e){return e.id}))),n.append("final_total",a),n.append("note",e.note),e.previewImages.forEach((function(e,t){n.append("files[".concat(t,"]"),e.file,e.name)})),t.prev=17,e.loading=!0,t.next=21,T.post("/operasional/post-ops-form-data",n,{headers:{"Content-Type":"multipart/form-data"}});case 21:r=t.sent,s=r.data,null!==s&&void 0!==s&&s.success?(null===(i=e.$toast)||void 0===i||i.success((null===s||void 0===s?void 0:s.msg)||"Data berhasil ditambahkan"),setTimeout((function(){e.$router.push({name:"Operasional"})}),2e3)):(null===(o=e.$toast)||void 0===o||o.error((null===s||void 0===s?void 0:s.msg)||"Ada kesalahan cek, console.warn"),console.log(s)),t.next=29;break;case 26:t.prev=26,t.t0=t["catch"](17),console.error(t.t0);case 29:return t.prev=29,e.loading=!1,t.finish(29);case 32:case"end":return t.stop()}}),t,null,[[17,26,29,32]])})))()},fetchParamsFromServer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/operasional/getOpsFormData");case 3:a=t.sent,e.initializeData(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Gagal mengambil data dari server:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},initializeData:function(e){this.opsList=e.opsNames||[],this.storeList=e.stores||[],this.poList=e.poList||[],this.complainList=e.complains||[],this.location=e.locations||{},this.selectedLocation=Object.keys(e.locations||[])[0]}},created:function(){this.fetchParamsFromServer()},mounted:function(){return Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},Wt=Gt,Yt=(a("8806"),Object(N["a"])(Wt,Kt,Jt,!1,null,"08fd9232",null)),Xt=Yt.exports,Zt=function(){var e,t=this,a=t._self._c;return a("div",[a("div",{staticClass:"header-container"},[a("h2",[t._v("Daftar PO Material")]),a(ot["a"],{attrs:{icon:"",color:"blue"},on:{click:t.goToMaterialForm}},[a(vt["a"],[t._v("mdi-plus-circle")])],1)],1),a(mt["a"],[a(gt["a"],{attrs:{row:"",wrap:""}},t._l(t.materialData,(function(e,n){return a(ft["a"],{key:n,attrs:{xs12:"",md4:""}},[a("MaterialItem",{attrs:{material:e},nativeOn:{click:function(a){return t.handleItemPress(e)}}})],1)})),1),t.materialData.length?t._e():a("div",{staticClass:"no-data-text"},[t._v("Tidak ada PO Material")])],1),a(Xe["a"],{attrs:{"max-width":"600"},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[t.selectedMaterial?a("pending"!=(null===(e=t.selectedMaterial)||void 0===e?void 0:e.status)?"MaterialShowScreen":"MaterialEditForm",{tag:"component",attrs:{selectedMaterial:t.selectedMaterial,paramsFromServer:t.paramsFromServer,onSubmitCompleted:t.onSubmitCompleted},on:{close:t.closeDialog}}):t._e()],1),t.loading?a(jt["a"],{attrs:{indeterminate:"",color:"primary"}}):t._e()],1)},ea=[],ta=function(){var e=this,t=e._self._c;return t(lt["a"],{staticClass:"material-item",on:{click:function(t){return e.$emit("click",e.material)}}},[t(ct["b"],[t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Ref No:")]),t("span",{staticClass:"value"},[e._v(e._s(e.material.ref_no))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Tanggal :")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatDate(e.material.sj_date)))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Teknisi:")]),t("span",{staticClass:"value"},[e._v(e._s(e.getFullName(e.material.teknisi)))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Status:")]),t("span",{staticClass:"value"},[e._v(e._s(e.material.status))])]),e.material.sj_note?t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Catatan:")]),t("span",{staticClass:"value"},[e._v(e._s(e.material.sj_note))])]):e._e()])],1)},aa=[],na={name:"MaterialItem",props:{material:{type:Object,required:!0}},methods:{getFullName:function(e){return e?"".concat(e.first_name||""," ").concat(e.surname||""," ").concat(e.last_name||"").trim():""},editMaterial:function(){this.$emit("edit",this.material)},deleteMaterial:function(){this.$emit("delete",this.material)},formatDate:function(e){var t={year:"numeric",month:"short",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)}}},ra=na,sa=(a("743e"),Object(N["a"])(ra,ta,aa,!1,null,"e73ab62e",null)),ia=sa.exports,oa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"material-form"},[t(mt["a"],[t(lt["a"],{staticClass:"mx-auto elevation-4",attrs:{"max-width":"600",outlined:""}},[t(ut["a"],{staticClass:"text-h1 text-center"},[e._v("PO Material")]),t(pt["a"]),t(ct["b"],[t("div",{staticClass:"section"},[t(Lt["a"],{staticClass:"location-select",attrs:{items:Object.entries(e.location).map((function(e){var t=Object(Ft["a"])(e,2),a=t[0],n=t[1];return{id:a,name:n}})),"item-value":"id","item-text":"name",label:"Pilih Lokasi",outlined:"",dense:""},on:{change:e.handleLocationChange},model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}})],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary","text-color":"blue darken-3",outlined:""},on:{click:function(t){e.showItemPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Tambah item ")],1),t(Xe["a"],{attrs:{"max-width":"500",transition:"dialog-bottom-transition"},model:{value:e.showItemPicker,callback:function(t){e.showItemPicker=t},expression:"showItemPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Item")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Item...",solo:""},model:{value:e.itemSearch,callback:function(t){e.itemSearch=t},expression:"itemSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredItemList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleItemChange(a.product_name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.product_name))])],1)],1)})),0===e.filteredItemList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Item tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showItemPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedItemList.length>0?t(gt["a"],{staticClass:"selected-material-list",attrs:{row:"",wrap:""}},e._l(e.selectedItemList,(function(a,n){return t(ft["a"],{key:n,staticClass:"selected-material-item",attrs:{xs12:""}},[t(lt["a"],{staticClass:"pa-3 mb-2",attrs:{elevation:"2"}},[t("p",{staticClass:"font-weight-bold"},[e._v(e._s(a.product_name))]),t(Dt["a"],{attrs:{label:"Qty",type:"number",dense:"",outlined:"",min:1,max:a.qty_available,oninput:"this.value = (parseFloat(this.max) < parseFloat(this.value) ? this.max : this.value)"},on:{input:function(t){return e.handleQtyChange(n)}},model:{value:a.qty,callback:function(t){e.$set(a,"qty",t)},expression:"material.qty"}}),t(ot["a"],{attrs:{icon:"",small:""},on:{click:function(t){return e.handleRemoveItem(n)}}},[t(vt["a"],{attrs:{color:"red"}},[e._v("mdi-delete")])],1)],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showStorePicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Toko ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showStorePicker,callback:function(t){e.showStorePicker=t},expression:"showStorePicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Toko")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Toko...",solo:""},model:{value:e.storeSearch,callback:function(t){e.storeSearch=t},expression:"storeSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredStoreList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleStoreChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredStoreList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Toko tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showStorePicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedStoreList.length>0?t(gt["a"],{staticClass:"selected-store-list",attrs:{row:"",wrap:""}},e._l(e.selectedStoreList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemoveStore(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showPoPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" DO (PO) ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showPoPicker,callback:function(t){e.showPoPicker=t},expression:"showPoPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih DO (PO)")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari DO...",solo:""},model:{value:e.poSearch,callback:function(t){e.poSearch=t},expression:"poSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredPoList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handlePoChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredPoList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("DO tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showPoPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedPoList.length>0?t(gt["a"],{staticClass:"selected-po-list",attrs:{row:"",wrap:""}},e._l(e.selectedPoList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemovePo(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showComplainPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Complain ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showComplainPicker,callback:function(t){e.showComplainPicker=t},expression:"showComplainPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Complain")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Complain...",solo:""},model:{value:e.complainSearch,callback:function(t){e.complainSearch=t},expression:"complainSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredComplainList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleComplainChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredComplainList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Complain tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showComplainPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedComplainList.length>0?t(gt["a"],{staticClass:"selected-complain-list",attrs:{row:"",wrap:""}},e._l(e.selectedComplainList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemoveComplain(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t(It["a"],{attrs:{rows:"3",label:"Catatan",outlined:"",dense:""},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),t(gt["a"],{staticClass:"mt-4",attrs:{row:"",wrap:"","align-center":"","justify-space-between":""}},[t(ot["a"],{staticClass:"btn-delete",attrs:{color:"red",large:""},on:{click:e.handleDelete}},[e._v(" Hapus ")]),t(ot["a"],{staticClass:"btn-update",staticStyle:{"background-color":"blue",color:"aliceblue"},attrs:{color:"success",large:""},on:{click:e.handleSubmit}},[e._v(" Perbarui ")])],1),e.error?t("p",{staticClass:"error-text mt-2"},[e._v(e._s(e.error))]):e._e()],1)],1)],1),e.loading?t(mt["a"],{staticClass:"d-flex justify-center align-center"},[t(jt["a"],{attrs:{indeterminate:"",color:"primary",size:"70"}})],1):e._e()],1)},la=[];function ca(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ua(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ca(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var da={props:["selectedMaterial","onSubmitCompleted"],data:function(){var e,t,a,n,r;return{allMaterialList:[],materialList:[],selectedItemList:(null===(e=this.selectedMaterial)||void 0===e||null===(e=e.lines)||void 0===e?void 0:e.map((function(e){var t;return ua(ua({},e),{},{unit_id:null===e||void 0===e||null===(t=e.unit)||void 0===t?void 0:t.id,unit:e.unit.short_name,product_name:"".concat(e.variation.product.name," ").concat("DUMMY"==e.variation.product_variation.name?"":e.variation.product_variation.name," ").concat("DUMMY"==e.variation.name?"":e.variation.name)})})))||[],showItemPicker:!1,storeList:[],selectedStoreList:(null===(t=this.selectedMaterial)||void 0===t||null===(t=t.any_store)||void 0===t?void 0:t.map((function(e){return{id:e.id,name:"".concat(e.store_code," ").concat(e.store_name)}})))||[],showStorePicker:!1,poList:[],selectedPoList:(null===(a=this.selectedMaterial)||void 0===a||null===(a=a.any_po)||void 0===a?void 0:a.map((function(e){var t,a;return{id:e.id,name:"".concat(null===e||void 0===e||null===(t=e.store)||void 0===t?void 0:t.store_code," ").concat(null===e||void 0===e||null===(a=e.store)||void 0===a?void 0:a.store_name)}})))||[],showPoPicker:!1,complainList:[],selectedComplainList:(null===(n=this.selectedMaterial)||void 0===n||null===(n=n.any_complain)||void 0===n?void 0:n.map((function(e){var t,a;return{id:e.id,name:"".concat(null===e||void 0===e||null===(t=e.store)||void 0===t?void 0:t.store_code," ").concat(null===e||void 0===e||null===(a=e.store)||void 0===a?void 0:a.store_name)}})))||[],showComplainPicker:!1,location:{},selectedLocation:(null===(r=this.selectedMaterial)||void 0===r?void 0:r.location_id)||"",note:"",error:"",itemSearch:"",storeSearch:"",poSearch:"",complainSearch:"",currentIndex:null,loading:!1}},computed:{filteredItemList:function(){var e=this;return this.materialList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.product_name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.itemSearch.toLowerCase())}))},filteredStoreList:function(){var e=this;return this.storeList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.storeSearch.toLowerCase())}))},filteredPoList:function(){var e=this;return this.poList.filter((function(t){return t.name.toLowerCase().includes(e.poSearch.toLowerCase())}))},filteredComplainList:function(){var e=this;return this.complainList.filter((function(t){return t.name.toLowerCase().includes(e.complainSearch.toLowerCase())}))},maxValue:function(){return this}},methods:{handleLocationChange:function(e){this.selectedLocation=e,this.filterMaterialsByLocation()},filterMaterialsByLocation:function(){var e=this;this.materialList=this.allMaterialList.filter((function(t){return t.location_id==e.selectedLocation}))},handleItemChange:function(e){if(!this.selectedItemList.some((function(t){return t.name===e}))){var t=this.materialList.find((function(t){return t.product_name===e}));this.selectedItemList.push(ua(ua({},t),{},{qty:1}))}this.showItemPicker=!1,this.itemSearch=""},handleStoreChange:function(e){if(e&&!this.selectedStoreList.some((function(t){return t.name===e}))){var t=this.storeList.find((function(t){return t.name===e}));t&&this.selectedStoreList.push(ua({},t))}this.showStorePicker=!1,this.storeSearch=""},handleQtyChange:function(e){var t=this.selectedItemList[e];console.log(t),t.qty>t.qty_available?t.qty=t.qty_available:t.qty<1&&(t.qty=1),t.qty%1===0&&(t.qty=Math.floor(t.qty))},handlePoChange:function(e){if(!this.selectedPoList.some((function(t){return t.name===e}))){var t=this.poList.find((function(t){return t.name===e}));this.selectedPoList.push(t)}this.showPoPicker=!1,this.poSearch=""},handleRemovePo:function(e){this.selectedPoList.splice(e,1)},handleComplainChange:function(e){if(!this.selectedComplainList.some((function(t){return t.name===e}))){var t=this.complainList.find((function(t){return t.name===e}));this.selectedComplainList.push(t)}this.showComplainPicker=!1,this.complainSearch=""},handleRemoveComplain:function(e){this.selectedComplainList.splice(e,1)},handleRemoveItem:function(e){this.selectedItemList.splice(e,1)},handleRemoveStore:function(e){this.selectedStoreList.splice(e,1)},handleDelete:function(){var e,t=this;confirm("Apakah Anda yakin ingin menghapus Pengajuan ini?")&&(this.loading=!0,T.delete("/surat-jalan/".concat(null===(e=this.selectedMaterial)||void 0===e?void 0:e.id)).then((function(e){var a;console.log("Data berhasil dihapus",e.data),t.onSubmitCompleted(ua(ua({},e.data),{},{remove:null===(a=t.selectedMaterial)||void 0===a?void 0:a.id}))})).catch((function(e){return console.error("Error deleting data:",e)})).finally((function(){t.loading=!1})))},handleSubmit:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.selectedItemList.length){t.next=3;break}return e.error="Harap tambahkan minimal satu nama Ops",t.abrupt("return");case 3:return e.error="",a=new FormData,a.append("location_id",e.selectedLocation),e.selectedItemList.forEach((function(e,t){a.append("products[".concat(t,"][variation_id]"),e.variation_id),a.append("products[".concat(t,"][unit_id]"),e.unit_id),a.append("products[".concat(t,"][qty]"),e.qty)})),a.append("stores",e.selectedStoreList.map((function(e){return e.id}))),a.append("pos",e.selectedPoList.map((function(e){return e.id}))),a.append("complains",e.selectedComplainList.map((function(e){return e.id}))),a.append("sj_note",e.note),t.prev=11,e.loading=!0,t.next=15,T.post("/surat-jalan/post-sj-form-data",a,{headers:{"Content-Type":"multipart/form-data"}});case 15:n=t.sent,r=n.data,null!==r&&void 0!==r&&r.success?(null===(s=e.$toast)||void 0===s||s.success((null===r||void 0===r?void 0:r.msg)||"Data berhasil ditambahkan"),setTimeout((function(){e.$router.push({name:"Material"})}),2e3)):(null===(i=e.$toast)||void 0===i||i.error((null===r||void 0===r?void 0:r.msg)||"Ada kesalahan cek, console.warn"),console.log(r)),t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](11),console.error(t.t0);case 23:return t.prev=23,e.loading=!1,t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[11,20,23,26]])})))()},fetchParamsFromServer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/material/getSJFormData");case 3:a=t.sent,e.initializeData(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Gagal mengambil data dari server:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},initializeData:function(e){var t;this.allMaterialList=e.products||[],this.storeList=e.stores||[],this.poList=e.poList||[],this.complainList=e.complains||[],this.location=e.locations||{},this.selectedLocation=(null===(t=this.selectedMaterial)||void 0===t||null===(t=t.location_id)||void 0===t?void 0:t.toString())||Object.keys(e.locations||[])[0]||"",this.filterMaterialsByLocation()}},created:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchParamsFromServer();case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){return Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},ma=da,pa=(a("c639"),Object(N["a"])(ma,oa,la,!1,null,"0a615e46",null)),fa=pa.exports,va=a("c954"),ha=function(){var e=this,t=e._self._c;return t(lt["a"],{staticClass:"material-show-screen"},[t(ut["a"],{staticClass:"title"},[e._v(" Detail PO Material ")]),t(pt["a"]),t(ct["b"],[t("section",{staticClass:"section"},[t("h3",{staticClass:"section-title"},[e._v("Informasi Umum")]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Reference No:")]),t("span",{staticClass:"value"},[e._v(e._s(e.selectedMaterial.ref_no))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Tanggal SJ:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatDate(e.selectedMaterial.sj_date)))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Status:")]),t(dt["a"],{class:e.statusClass,attrs:{small:""}},[e._v(e._s(e._f("capitalize")(e.selectedMaterial.status)))])],1),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Catatan:")]),t("span",{staticClass:"value"},[e._v(e._s(e.selectedMaterial.sj_note||"Tidak ada catatan"))])])]),t(pt["a"]),t("section",{staticClass:"section"},[t("h3",{staticClass:"section-title"},[e._v("Team Works")]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Teknisi:")]),t("span",{staticClass:"value"},[e._v(e._s(e.getFullName(e.selectedMaterial.teknisi)))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Helper:")]),t("span",{staticClass:"value"},[e._v(e._s(e.getFullName(e.selectedMaterial.helper)))])]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Driver:")]),t("span",{staticClass:"value"},[e._v(e._s(e.getFullName(e.selectedMaterial.driver)))])])]),t(pt["a"]),t("section",{staticClass:"section"},[t("h3",{staticClass:"section-title"},[e._v("Lokasi & Toko")]),t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Lokasi:")]),t("span",{staticClass:"value"},[e._v(e._s(e.selectedMaterial.location.name))])]),e.selectedMaterial.any_complain&&e.selectedMaterial.any_complain.length?t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Toko:")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.selectedMaterial.any_complain.map((function(e){var t,a;return"".concat(null===(t=e.store)||void 0===t?void 0:t.store_code," ").concat(null===(a=e.store)||void 0===a?void 0:a.store_name)})).join(", "))+" ")])]):e._e(),e.selectedMaterial.any_store&&e.selectedMaterial.any_store.length?t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Toko:")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.selectedMaterial.any_store.map((function(e){return"".concat(e.store_code," ").concat(e.store_name)})).join(", "))+" ")])]):e._e(),e.selectedMaterial.any_po&&e.selectedMaterial.any_po.length?t("div",{staticClass:"info-row"},[t("span",{staticClass:"label"},[e._v("Toko:")]),t("span",{staticClass:"value"},[e._v(" "+e._s(e.selectedMaterial.any_po.map((function(e){var t,a;return"".concat(null===(t=e.store)||void 0===t?void 0:t.store_code," ").concat(null===(a=e.store)||void 0===a?void 0:a.store_name)})).join(", "))+" ")])]):e._e()]),t(pt["a"]),e.selectedMaterial.lines&&e.selectedMaterial.lines.length?t("section",{staticClass:"section"},[t("h3",{staticClass:"section-title"},[e._v("Daftar Item")]),t(Ot["a"],{attrs:{dense:""}},e._l(e.selectedMaterial.lines,(function(a){return t(Pt["a"],{key:a.id,staticClass:"list-item"},[t(va["a"],[t("img",{attrs:{src:a.variation.product.image_url||e.defaultImage}})]),t(St["a"],[t(St["c"],[e._v(" "+e._s(a.variation.product.name)+" "),"DUMMY"!==a.variation.product_variation.name?t("span",{staticClass:"variation-name"},[e._v(" - "+e._s(a.variation.product_variation.name)+" ")]):e._e()]),t(St["b"],[e._v(" "+e._s(parseInt(a.qty))+" "+e._s(a.unit.short_name)+" ")])],1),t(pt["a"])],1)})),1)],1):e._e()],1),t(pt["a"]),t(ct["a"],[t(ot["a"],{staticStyle:{color:"white","background-color":"red"},on:{click:function(t){return e.$emit("close")}}},[e._v("Tutup")])],1)],1)},ga=[],ba={name:"MaterialShowScreen",props:{selectedMaterial:{type:Object,required:!0}},data:function(){return{defaultImage:"https://ac.igm.biz.id/img/default.png"}},computed:{statusClass:function(){switch(this.selectedMaterial.status){case"completed":return"status-completed";case"pending":return"status-pending";case"in-progress":return"status-in-progress";default:return""}}},methods:{getFullName:function(e){return e?"".concat(e.first_name||""," ").concat(e.surname||""," ").concat(e.last_name||"").trim():""},formatDate:function(e){var t={year:"numeric",month:"short",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)}},filters:{capitalize:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}}},_a=ba,ka=(a("1cfa"),Object(N["a"])(_a,ha,ga,!1,null,"05affe0b",null)),Ca=ka.exports,wa={components:{MaterialItem:ia,MaterialEditForm:fa,MaterialShowScreen:Ca},data:function(){return{materialData:[],loading:!1,formVisible:!1,dialogVisible:!1,selectedMaterial:null,paramsFromServer:{}}},methods:{fetchMaterial:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,T.get("/surat-jalan");case 4:a=t.sent,e.materialData=a.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error("Error fetching materials:",t.t0);case 11:return t.prev=11,e.loading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},goToMaterialForm:function(){this.$router.push({name:"MaterialForm"})},fetchFormMaterial:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/material/getSJFormData");case 3:a=t.sent,e.paramsFromServer=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error fetching form data:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},onSubmitCompleted:function(e){var t=e.success,a=e.msg,n=e.remove;this.formVisible=!1,t?(this.fetchMaterial(),this.$toast.success(a||"Data berhasil disimpan.")):this.$toast.error(a||"Terjadi kesalahan. Silakan coba lagi."),this.closeDialog(),n&&(this.materialData=this.materialData.filter((function(e){return e.id!==n})))},handleItemPress:function(e){this.selectedMaterial=e,this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1,this.selectedMaterial=null}},created:function(){this.fetchMaterial()}},ya=wa,xa=(a("e9d1"),Object(N["a"])(ya,Zt,ea,!1,null,"43e5d177",null)),Oa=xa.exports,Pa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"material-form"},[t(mt["a"],[t(lt["a"],{staticClass:"mx-auto elevation-4",attrs:{"max-width":"600",outlined:""}},[t(ut["a"],{staticClass:"text-h1 text-center"},[e._v("PO Material")]),t(pt["a"]),t(ct["b"],[t("div",{staticClass:"section"},[t(Lt["a"],{staticClass:"location-select",attrs:{items:Object.entries(e.location).map((function(e){var t=Object(Ft["a"])(e,2),a=t[0],n=t[1];return{id:a,name:n}})),"item-value":"id","item-text":"name",label:"Pilih Lokasi",outlined:"",dense:""},on:{change:e.handleLocationChange},model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}})],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary","text-color":"blue darken-3",outlined:""},on:{click:function(t){e.showItemPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Tambah item ")],1),t(Xe["a"],{attrs:{"max-width":"500",transition:"dialog-bottom-transition"},model:{value:e.showItemPicker,callback:function(t){e.showItemPicker=t},expression:"showItemPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Item")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Item...",solo:""},model:{value:e.itemSearch,callback:function(t){e.itemSearch=t},expression:"itemSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredItemList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleItemChange(a.product_name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.product_name))])],1)],1)})),0===e.filteredItemList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Item tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showItemPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedItemList.length>0?t(gt["a"],{staticClass:"selected-material-list",attrs:{row:"",wrap:""}},e._l(e.selectedItemList,(function(a,n){return t(ft["a"],{key:n,staticClass:"selected-material-item",attrs:{xs12:""}},[t(lt["a"],{staticClass:"pa-3 mb-2",attrs:{elevation:"2"}},[t("p",{staticClass:"font-weight-bold"},[e._v(e._s(a.product_name))]),t(Dt["a"],{attrs:{label:"Qty",type:"number",dense:"",outlined:"",min:1,max:a.qty_available,oninput:"this.value = (parseFloat(this.max) < parseFloat(this.value) ? this.max : this.value)"},on:{input:function(t){return e.handleQtyChange(n)}},model:{value:a.qty,callback:function(t){e.$set(a,"qty",t)},expression:"material.qty"}}),t(ot["a"],{attrs:{icon:"",small:""},on:{click:function(t){return e.handleRemoveItem(n)}}},[t(vt["a"],{attrs:{color:"red"}},[e._v("mdi-delete")])],1)],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showStorePicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Toko ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showStorePicker,callback:function(t){e.showStorePicker=t},expression:"showStorePicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Toko")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Toko...",solo:""},model:{value:e.storeSearch,callback:function(t){e.storeSearch=t},expression:"storeSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredStoreList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleStoreChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredStoreList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Toko tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showStorePicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedStoreList.length>0?t(gt["a"],{staticClass:"selected-store-list",attrs:{row:"",wrap:""}},e._l(e.selectedStoreList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemoveStore(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showPoPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" DO (PO) ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showPoPicker,callback:function(t){e.showPoPicker=t},expression:"showPoPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih DO (PO)")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari DO...",solo:""},model:{value:e.poSearch,callback:function(t){e.poSearch=t},expression:"poSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredPoList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handlePoChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredPoList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("DO tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showPoPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedPoList.length>0?t(gt["a"],{staticClass:"selected-po-list",attrs:{row:"",wrap:""}},e._l(e.selectedPoList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemovePo(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t("div",{staticClass:"section"},[t(ot["a"],{staticClass:"mb-3 btn-custom",attrs:{color:"primary",outlined:""},on:{click:function(t){e.showComplainPicker=!0}}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-plus-circle")]),e._v(" Complain ")],1),t(Xe["a"],{attrs:{"max-width":"500"},model:{value:e.showComplainPicker,callback:function(t){e.showComplainPicker=t},expression:"showComplainPicker"}},[t(lt["a"],[t(ut["a"],{staticClass:"text-h6"},[e._v("Pilih Complain")]),t(pt["a"]),t(ct["b"],[t(Dt["a"],{attrs:{placeholder:"Cari Complain...",solo:""},model:{value:e.complainSearch,callback:function(t){e.complainSearch=t},expression:"complainSearch"}}),t(Ot["a"],{attrs:{dense:""}},[e._l(e.filteredComplainList,(function(a,n){return t(Pt["a"],{key:n,staticClass:"result-item",on:{click:function(t){return e.handleComplainChange(a.name)}}},[t(St["a"],[t(St["c"],[e._v(e._s(a.name))])],1)],1)})),0===e.filteredComplainList.length?t(Pt["a"],[t(St["a"],[t(St["c"],[e._v("Complain tidak ditemukan")])],1)],1):e._e()],2)],1),t(pt["a"]),t(ct["a"],[t(bt["a"]),t(ot["a"],{attrs:{text:""},on:{click:function(t){e.showComplainPicker=!1}}},[e._v("Tutup")])],1)],1)],1),e.selectedComplainList.length>0?t(gt["a"],{staticClass:"selected-complain-list",attrs:{row:"",wrap:""}},e._l(e.selectedComplainList,(function(a,n){return t(ft["a"],{key:n,attrs:{xs12:""}},[t(dt["a"],{attrs:{color:"indigo lighten-2","text-color":"white"}},[e._v(" "+e._s(a.name)+" "),t(vt["a"],{staticStyle:{color:"aliceblue","font-size":"large"},attrs:{right:""},on:{click:function(t){return e.handleRemoveComplain(n)}}},[e._v("mdi-close-circle")])],1)],1)})),1):e._e()],1),t(It["a"],{attrs:{rows:"3",label:"Catatan",outlined:"",dense:""},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),t(ot["a"],{staticClass:"mt-4 btn-submit",staticStyle:{"background-color":"blue",color:"aliceblue"},attrs:{color:"success",block:"",large:""},on:{click:e.handleSubmit}},[e._v("Kirim")]),e.error?t("p",{staticClass:"error-text mt-2"},[e._v(e._s(e.error))]):e._e()],1)],1)],1),e.loading?t(mt["a"],{staticClass:"d-flex justify-center align-center"},[t(jt["a"],{attrs:{indeterminate:"",color:"primary",size:"70"}})],1):e._e()],1)},Sa=[];function ja(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function La(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ja(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ja(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Da={props:["paramsFromServer"],data:function(){return{allMaterialList:[],materialList:[],selectedItemList:[],showItemPicker:!1,storeList:[],selectedStoreList:[],showStorePicker:!1,poList:[],selectedPoList:[],showPoPicker:!1,complainList:[],selectedComplainList:[],showComplainPicker:!1,location:{},selectedLocation:"",note:"",error:"",itemSearch:"",storeSearch:"",poSearch:"",complainSearch:"",currentIndex:null,loading:!1,chip1:!0,chip2:!0,chip3:!0,chip4:!0}},computed:{filteredItemList:function(){var e=this;return this.materialList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.product_name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.itemSearch.toLowerCase())}))},filteredStoreList:function(){var e=this;return this.storeList.filter((function(t){var a;return null===t||void 0===t||null===(a=t.name)||void 0===a||null===(a=a.toLowerCase())||void 0===a?void 0:a.includes(e.storeSearch.toLowerCase())}))},filteredPoList:function(){var e=this;return this.poList.filter((function(t){return t.name.toLowerCase().includes(e.poSearch.toLowerCase())}))},filteredComplainList:function(){var e=this;return this.complainList.filter((function(t){return t.name.toLowerCase().includes(e.complainSearch.toLowerCase())}))},maxValue:function(){return this}},methods:{handleClose:function(){console.log("Chip closed")},handleLocationChange:function(e){this.selectedLocation=e,this.filterMaterialsByLocation()},filterMaterialsByLocation:function(){var e=this;this.materialList=this.allMaterialList.filter((function(t){return t.location_id==e.selectedLocation}))},handleItemChange:function(e){if(!this.selectedItemList.some((function(t){return t.name===e}))){var t=this.materialList.find((function(t){return t.product_name===e}));this.selectedItemList.push(La(La({},t),{},{qty:1}))}this.showItemPicker=!1,this.itemSearch=""},handleStoreChange:function(e){if(e&&!this.selectedStoreList.some((function(t){return t.name===e}))){var t=this.storeList.find((function(t){return t.name===e}));t&&this.selectedStoreList.push(La({},t))}this.showStorePicker=!1,this.storeSearch=""},handleQtyChange:function(e){var t=this.selectedItemList[e];t.qty>t.qty_available?t.qty=t.qty_available:t.qty<1&&(t.qty=1),t.qty%1===0&&(t.qty=Math.floor(t.qty))},handlePoChange:function(e){if(!this.selectedPoList.some((function(t){return t.name===e}))){var t=this.poList.find((function(t){return t.name===e}));this.selectedPoList.push(t)}this.showPoPicker=!1,this.poSearch=""},handleRemovePo:function(e){this.selectedPoList.splice(e,1)},handleComplainChange:function(e){if(!this.selectedComplainList.some((function(t){return t.name===e}))){var t=this.complainList.find((function(t){return t.name===e}));this.selectedComplainList.push(t)}this.showComplainPicker=!1,this.complainSearch=""},handleRemoveComplain:function(e){this.selectedComplainList.splice(e,1)},handleRemoveItem:function(e){this.selectedItemList.splice(e,1)},handleRemoveStore:function(e){this.selectedStoreList.splice(e,1)},handleSubmit:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.selectedItemList.length){t.next=3;break}return e.error="Harap tambahkan minimal satu nama Ops",t.abrupt("return");case 3:return e.error="",a=new FormData,a.append("location_id",e.selectedLocation),e.selectedItemList.forEach((function(e,t){a.append("products[".concat(t,"][variation_id]"),e.variation_id),a.append("products[".concat(t,"][unit_id]"),e.unit_id),a.append("products[".concat(t,"][qty]"),e.qty)})),a.append("stores",e.selectedStoreList.map((function(e){return e.id}))),a.append("pos",e.selectedPoList.map((function(e){return e.id}))),a.append("complains",e.selectedComplainList.map((function(e){return e.id}))),a.append("sj_note",e.note),t.prev=11,e.loading=!0,t.next=15,T.post("/surat-jalan/post-sj-form-data",a,{headers:{"Content-Type":"multipart/form-data"}});case 15:n=t.sent,r=n.data,null!==r&&void 0!==r&&r.success?(null===(s=e.$toast)||void 0===s||s.success((null===r||void 0===r?void 0:r.msg)||"Data berhasil ditambahkan"),setTimeout((function(){e.$router.push({name:"Material"})}),2e3)):(null===(i=e.$toast)||void 0===i||i.error((null===r||void 0===r?void 0:r.msg)||"Ada kesalahan cek, console.warn"),console.log(r)),t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](11),console.error(t.t0);case 23:return t.prev=23,e.loading=!1,t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[11,20,23,26]])})))()},fetchParamsFromServer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/material/getSJFormData");case 3:a=t.sent,e.initializeData(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Gagal mengambil data dari server:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},initializeData:function(e){this.allMaterialList=e.products||[],this.storeList=e.stores||[],this.poList=e.poList||[],this.complainList=e.complains||[],this.location=e.locations||{},this.selectedLocation=Object.keys(e.locations||[])[0],this.filterMaterialsByLocation()}},created:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchParamsFromServer();case 2:case"end":return t.stop()}}),t)})))()},mounted:function(){return Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},Ia=Da,Fa=(a("6476"),Object(N["a"])(Ia,Pa,Sa,!1,null,"e2f11d28",null)),Ra=Fa.exports,Ta=function(){var e,t,a=this,n=a._self._c;return n("div",{staticClass:"safe-area"},[n("router-link",{attrs:{to:{name:"EditProfile",params:{userData:a.userData}}}},[n("button",{staticClass:"edit-button"},[n("i",{staticClass:"fa fa-edit edit-btn"})])]),n("div",{staticClass:"profile-container"},[n("img",{staticClass:"profile-image",attrs:{src:a.userData&&a.userData.media?a.userData.media.display_url:"/assets/images/default_profile.png",alt:"Profile Image"}}),n("h1",{staticClass:"title"},[a._v("Profile")]),a.userData?n("div",{staticClass:"data-profile-container"},[n("div",{staticClass:"info-container"},[n("span",{staticClass:"label"},[a._v("Name:")]),n("span",{staticClass:"value"},[a._v(a._s(a.userData.surname)+" "+a._s(a.userData.first_name)+" "+a._s(a.userData.last_name))])]),n("div",{staticClass:"info-container"},[n("span",{staticClass:"label"},[a._v("Username:")]),n("span",{staticClass:"value"},[a._v(a._s(a.userData.username))])]),n("div",{staticClass:"info-container"},[n("span",{staticClass:"label"},[a._v("Email:")]),n("span",{staticClass:"value"},[a._v(a._s(a.userData.email))])]),n("div",{staticClass:"info-container"},[n("span",{staticClass:"label"},[a._v("Jabatan:")]),a.userData.jabatan?n("span",{staticClass:"value"},[a._v(a._s(a.userData.jabatan.name))]):a._e()]),n("div",{staticClass:"info-container"},[n("span",{staticClass:"label"},[a._v("Bank:")]),n("span",{staticClass:"value"},[a._v(a._s(null===(e=a.bankDetails)||void 0===e?void 0:e.bank_name)+" - "+a._s(null===(t=a.bankDetails)||void 0===t?void 0:t.account_number))])]),a.documents&&a.documents.length?n("div",{staticClass:"documents-container"},a._l(a.documents,(function(e,t){return n("div",{key:t,staticClass:"info-container",on:{click:function(t){return a.openDocument(e)}}},[n("span",{staticClass:"document-label"},[a._v(a._s(e.description)+":")]),n("i",{staticClass:"fa fa-chevron-right"})])})),0):a._e(),n("div",{staticClass:"logout-button-container"},[n("button",{on:{click:a.handleLogout}},[a._v("Logout")])]),a._m(0)]):a._e()]),a.showPdfViewer?n("div",{staticClass:"pdf-viewer-modal"},[n("button",{on:{click:a.closePdfViewer}},[a._v("Close")]),n("PDFViewer",{attrs:{source:a.pdfUrl,controls:["zoom"],settings:{defaultZoom:200}}})],1):a._e()],1)},Ma=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"version"},[t("span",{staticClass:"version-text"},[e._v("Versi 1.0")])])}],Aa=a("73e9"),Na=a.n(Aa),Ea={components:{PDFViewer:Na.a},setup:function(){var e=Object(n["ref"])(null),t=Object(n["ref"])({}),a=Object(n["ref"])([]),r=Object(n["ref"])(!1),s=Object(n["ref"])(null),i=Object(n["ref"])(!0),o=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.value=!0,e.prev=1,e.next=4,T.post("/logout");case 4:localStorage.clear(),location.replace("/login"),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](1),console.error("Logout failed:",e.t0);case 11:return e.prev=11,i.value=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})));return function(){return e.apply(this,arguments)}}(),l=function(){var a=Object(h["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,T.get("/user");case 3:n=a.sent,r=n.data,e.value=r,t.value=JSON.parse((null===r||void 0===r?void 0:r.bank_details)||"{}"),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error("Error fetching user data:",a.t0);case 12:return a.prev=12,i.value=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[0,9,12,15]])})));return function(){return a.apply(this,arguments)}}(),c=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.get("/documents");case 3:t=e.sent,a.value=t.data,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("Error fetching documents:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),u=function(e){s.value="https://ac.igm.biz.id/public/uploads/documents/".concat(e.name,"#toolbar=0&navpanes=0&scrollbar=1"),r.value=!0},d=function(){r.value=!1,s.value=null},m=function(e){var t=e.src,a=e.filename,n=document.createElement("a");n.href=t,n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n),console.log(t,a)};return Object(n["onMounted"])((function(){l(),c()})),{userData:e,bankDetails:t,documents:a,loading:i,handleLogout:o,showPdfViewer:r,pdfUrl:s,openDocument:u,closePdfViewer:d,handleDownload:m}}},qa=Ea,$a=(a("cc26"),Object(N["a"])(qa,Ta,Ma,!1,null,"3d12b9af",null)),Ba=$a.exports,za=function(){var e=this,t=e._self._c;return t("div",{staticClass:"safe-area"},[t("div",{staticClass:"custom-header"}),t("div",{staticClass:"form-container"},[t("div",{staticClass:"image-container"},[t("img",{staticClass:"profile-image",attrs:{src:e.profilePhoto?e.profilePhoto.uri:e.userData&&e.userData.media?e.userData.media.display_url:"/assets/images/default_profile.png",alt:"Profile Image"}}),t("button",{staticClass:"edit-icon",on:{click:e.pickImage}},[t("i",{staticClass:"fa fa-edit"})]),t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.handleFileChange}})]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.surName,expression:"surName"}],staticClass:"input",attrs:{placeholder:"SurName"},domProps:{value:e.surName},on:{input:function(t){t.target.composing||(e.surName=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.firstName,expression:"firstName"}],staticClass:"input",attrs:{placeholder:"First Name"},domProps:{value:e.firstName},on:{input:function(t){t.target.composing||(e.firstName=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.lastName,expression:"lastName"}],staticClass:"input",attrs:{placeholder:"Last Name"},domProps:{value:e.lastName},on:{input:function(t){t.target.composing||(e.lastName=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"input",attrs:{placeholder:"Email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.bank_name,expression:"bank_name"}],staticClass:"input",attrs:{placeholder:"Nama Bank"},domProps:{value:e.bank_name},on:{input:function(t){t.target.composing||(e.bank_name=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.account_holder,expression:"account_holder"}],staticClass:"input",attrs:{placeholder:"Pemilik Rekening"},domProps:{value:e.account_holder},on:{input:function(t){t.target.composing||(e.account_holder=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.account_number,expression:"account_number"}],staticClass:"input",attrs:{placeholder:"No Rekeing"},domProps:{value:e.account_number},on:{input:function(t){t.target.composing||(e.account_number=t.target.value)}}}),e._m(0),t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentPassword,expression:"currentPassword"}],staticClass:"input",attrs:{type:"password",placeholder:"Current Password"},domProps:{value:e.currentPassword},on:{input:function(t){t.target.composing||(e.currentPassword=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmPassword,expression:"confirmPassword"}],staticClass:"input",attrs:{type:"password",placeholder:"Confirm Password"},domProps:{value:e.confirmPassword},on:{input:function(t){t.target.composing||(e.confirmPassword=t.target.value)}}}),t("button",{staticClass:"save-button",on:{click:e.handleSave}},[e._v("Simpan")])]),e.loading?t("div",{staticClass:"loading-overlay"},[t("i",{staticClass:"fa fa-spinner fa-spin"})]):e._e()])},Ua=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"info-container"},[t("span",{staticClass:"label"},[e._v("Lewati jika tidak ada peubahan password!:")])])}],Va={setup:function(){var e=Object(n["ref"])(null),t=Object(n["ref"])(""),a=Object(n["ref"])(""),s=Object(n["ref"])(""),i=Object(n["ref"])(""),o=Object(n["ref"])(""),l=Object(n["ref"])(""),c=Object(n["ref"])(""),u=Object(n["ref"])(""),d=Object(n["ref"])(""),m=Object(n["ref"])(""),p=Object(n["ref"])(null),f=Object(n["ref"])(!1),v=Object(n["ref"])(null),g=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:v.value.click();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(){p.value={uri:URL.createObjectURL(t),file:t}},a.readAsDataURL(t)}},_=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){var n,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(u.value===d.value){e.next=3;break}return r.a.$toast.error("Password tidak sama!"),e.abrupt("return");case 3:if(!u.value||m.value){e.next=6;break}return r.a.$toast.error("Passwords tidak boleh kosong!"),e.abrupt("return");case 6:return f.value=!0,e.prev=7,n=new FormData,n.append("surname",t.value),n.append("first_name",a.value),n.append("last_name",s.value),n.append("email",i.value),n.append("bank_name",o.value),n.append("account_holder_name",l.value),n.append("account_number",c.value),u.value&&(n.append("password",u.value),n.append("current_password",m.value)),p.value&&p.value.file&&n.append("profile_photo",p.value.file),e.next=20,T.post("/user",n,{headers:{"Content-Type":"multipart/form-data"}});case 20:v=e.sent,200===v.status?r.a.$toast.success("Profile berhasil diupdate"):r.a.$toast.error("Failed to update profile"),e.next=27;break;case 24:e.prev=24,e.t0=e["catch"](7),r.a.$toast.error("Failed to update profile");case 27:return e.prev=27,f.value=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[7,24,27,30]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/user");case 3:a=t.sent,e.value=a.data,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),r.a.$toast.error("Error fetching user data");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return Object(n["onMounted"])((function(){k()})),Object(n["watch"])(e,(function(e){if(e){t.value=e.surname||"",a.value=e.first_name||"",s.value=e.last_name||"",i.value=e.email||"",p.value=e.profile_photo||null;var n=JSON.parse(e.bank_details||"{}");o.value=n.bank_name||"",l.value=n.account_holder_name||"",c.value=n.account_number||""}})),{userData:e,surName:t,firstName:a,lastName:s,email:i,bank_name:o,account_holder:l,account_number:c,password:u,confirmPassword:d,currentPassword:m,profilePhoto:p,loading:f,pickImage:g,handleFileChange:b,handleSave:_,fileInput:v}}},Ka=Va,Ja=(a("20d2"),Object(N["a"])(Ka,za,Ua,!1,null,"554b2e8a",null)),Ha=Ja.exports,Qa=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"header-container"},[t("h1",{staticClass:"title"},[e._v("Daftar Alat / Asset")]),t(ot["a"],{attrs:{icon:"",color:"blue"},on:{click:e.navigateToAddTool}},[t(vt["a"],[e._v("mdi-plus-circle")])],1)],1),e.pendingRequestTool.length?t("div",{staticClass:"container-hz"},[t("div",{staticStyle:{height:"150px","overflow-x":"scroll"}},[t("div",{staticClass:"header-container-hz"},e._l(e.pendingRequestTool,(function(a,n){return t("div",{key:n,staticClass:"item-container-hz pending",on:{click:function(t){return e.handleItemPress(a)}}},[t("div",{staticClass:"row"},[t("span",{staticClass:"item-text"},[e._v(e._s(a.asset_name.name)+" (Pending)")])]),t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("No Ref :")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.no_ref))])]),t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("Tanggal :")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.trx_date))])]),t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("Person :")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.person.nickname))])])])})),0)])]):e._e(),e.toolingData.length?t("div",{staticClass:"container"},e._l(e.toolingData,(function(a,n){return t("div",{key:n,staticClass:"item-container",on:{click:function(t){return e.handleItemPress(a)}}},[t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("Nama Asset:")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.asset))])]),t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("No Ref:")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.ref_no))])]),t("div",{staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v("Dialokasikan Dari:")]),t("span",{staticClass:"item-value"},[e._v(e._s(a.allocated_at))])])])})),0):e._e(),e.detailVisible?t("div",{staticClass:"modal-overlay",on:{click:function(t){if(t.target!==t.currentTarget)return null;e.detailVisible=!1}}},[t("div",{staticClass:"modal-content"},[t("h2",[e._v("Detail Asset")]),e.selectedAsset?t("div",e._l(e.assetDetails,(function(a,n){return t("div",{key:n,staticClass:"row"},[t("span",{staticClass:"item-label"},[e._v(e._s(n)+":")]),t("span",{staticClass:"item-value"},[e._v(e._s(a))])])})),0):e._e(),t("button",{staticClass:"close-button",on:{click:function(t){e.detailVisible=!1}}},[e._v("Tutup")])])]):e._e()])},Ga=[],Wa={data:function(){return{toolingData:[],pendingRequestTool:[],detailVisible:!1,selectedAsset:null}},computed:{assetDetails:function(){var e,t,a,n,r;return this.selectedAsset?"pending"==(null===(e=this.selectedAsset)||void 0===e?void 0:e.status)?{"No ref":null===(t=this.selectedAsset)||void 0===t?void 0:t.no_ref,"Nama Asset":null===(a=this.selectedAsset)||void 0===a||null===(a=a.asset_name)||void 0===a?void 0:a.name,Person:null===(n=this.selectedAsset)||void 0===n||null===(n=n.person)||void 0===n?void 0:n.nickname,Jumlah:null===(r=this.selectedAsset)||void 0===r?void 0:r.qty,Status:"Pending"}:{"No Ref":this.selectedAsset.ref_no,"Nama Asset":this.selectedAsset.asset,Model:this.selectedAsset.model,Jumlah:this.selectedAsset.quantity,"Admin Asset":this.selectedAsset.provider_name,Penerima:this.selectedAsset.receiver_name,"Dialokasikan Dari":this.selectedAsset.allocated_at,"Dialokasikan Hingga":this.selectedAsset.allocated_upto}:{}}},methods:{fetchTooling:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/asset/asset-list");case 3:a=t.sent,e.toolingData=a.data.assets||[],e.pendingRequestTool=a.data.asset_loans||[],t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error fetching tooling data",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},handleItemPress:function(e){this.selectedAsset=e,this.detailVisible=!0},navigateToAddTool:function(){this.$router.push({name:"ToolingForm"})}},created:function(){this.fetchTooling()}},Ya=Wa,Xa=(a("ad2a"),Object(N["a"])(Ya,Qa,Ga,!1,null,"469fbce7",null)),Za=Xa.exports,en=function(){var e=this,t=e._self._c;return t("div",{staticClass:"form-container"},[t("h2",{staticStyle:{"margin-bottom":"1em"}},[e._v("Pengajuan Peminjaman Alat/Aset")]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"asset-search"}},[e._v("Pilih Daftar Asset")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],staticClass:"form-input",attrs:{autocomplete:"off",type:"text",id:"asset-search",placeholder:"Cari Alat / Asset"},domProps:{value:e.searchQuery},on:{focus:function(t){e.showDropdown=!0},input:[function(t){t.target.composing||(e.searchQuery=t.target.value)},e.filterAssets],blur:e.hideDropdown}}),e.showDropdown&&e.filteredAssets.length?t("div",{staticClass:"dropdown",on:{mousedown:function(e){e.preventDefault()}}},e._l(e.filteredAssets,(function(a,n){return t("div",{key:n,staticClass:"dropdown-item",on:{click:function(t){return e.selectAsset(a)}}},[e._v(" "+e._s(a.name)+" ")])})),0):e._e()]),e.selectedAsset?t("div",{staticClass:"selected-asset"},[t("strong",[e._v("Alat / Asset :")]),e._v(" "+e._s(e.selectedAsset.name)+" ")]):e._e(),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-submit",attrs:{type:"button",disabled:!e.selectedAsset},on:{click:e.submitAsset}},[e._v(" Ajukan ")]),t("button",{staticClass:"btn-cancel",attrs:{type:"button"},on:{click:e.closeForm}},[e._v("Cancel")])])])},tn=[],an=a("53ca"),nn={data:function(){return{toolFromServer:[],filteredAssets:[],searchQuery:"",selectedAsset:null,showDropdown:!1,loading:!1}},methods:{fetchFormTooling:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.get("/asset/getAssetFormData");case 3:a=t.sent,n=a.data,n&&"object"===Object(an["a"])(n)&&(e.toolFromServer=Object.entries(n).map((function(e){var t=Object(Ft["a"])(e,2),a=t[0],n=t[1];return{key:a,name:n.split(" (")[0].trim()}})),e.filteredAssets=e.toolFromServer),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error fetching form data",t.t0),null===(r=e.$toast)||void 0===r||r.error("Error fetching form data. Please try again.");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},filterAssets:function(){var e=this;this.filteredAssets=this.toolFromServer.filter((function(t){return t.name.toLowerCase().includes(e.searchQuery.toLowerCase())}))},selectAsset:function(e){this.selectedAsset=e,this.showDropdown=!1,this.searchQuery=e.name},hideDropdown:function(){var e=this;setTimeout((function(){return e.showDropdown=!1}),200)},submitAsset:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,T.post("/asset/post-asset-loan-form",{asset_id:e.selectedAsset.key});case 4:a=t.sent,n=a.data,r=n.success,s=n.msg,r?(null===e||void 0===e||e.$toast.success(s||"Data berhasil disimpan."),setTimeout((function(){e.$router.push({name:"Tooling"})}),2e3)):null===(i=e.$toast)||void 0===i||i.error(s||"Terjadi kesalahan. Silakan coba lagi."),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error("Error submitting asset",t.t0),null===(o=e.$toast)||void 0===o||o.error("Error submitting asset. Please try again.");case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,9,13,16]])})))()},closeForm:function(){this.$router.push({name:"Tooling"})}},created:function(){this.fetchFormTooling()}},rn=nn,sn=(a("0fae"),Object(N["a"])(rn,en,tn,!1,null,"03f375fc",null)),on=sn.exports,ln=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("h2",{staticClass:"header"},[e._v("Daftar Kasbon")]),0===e.kasbonList.length?t("div",{staticClass:"empty"},[e._v(" Tidak ada data kasbon. ")]):e._e(),e._l(e.kasbonList,(function(a){return t("KasbonItem",{key:a.id,attrs:{kasbon:a},on:{press:e.showKasbonDetail}})})),t("KasbonDetail",{attrs:{kasbon:e.selectedKasbon,visible:e.modalVisible},on:{close:e.closeModal}}),t("button",{staticClass:"add-button",on:{click:function(){return e.visibleForm=!0}}},[e._v(" Tambah Kasbon Baru ")]),e.visibleForm?t("KasbonForm",{attrs:{visible:e.visibleForm},on:{close:function(t){e.visibleForm=!1},refreshData:e.fetchKasbonList}}):e._e()],2)},cn=[],un=function(){var e=this,t=e._self._c;return t("div",{staticClass:"kasbon-item",on:{click:function(t){return e.$emit("press",e.kasbon)}}},[t("h3",[e._v("Kasbon "+e._s(e.kasbon.ref_no))]),t("p",[e._v("Jumlah: "+e._s(e.formatCurrency(e.kasbon.amount)))]),t("p",[e._v("Tenor: "+e._s(e.kasbon.tenor)+" bulan")]),t("p",[e._v("Status: "+e._s(e.kasbon.status))]),t("p",[e._v("Keperluan: "+e._s(e.kasbon.keperluan))])])},dn=[],mn={props:["kasbon"],methods:{formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)}}},pn=mn,fn=(a("2b1c"),Object(N["a"])(pn,un,dn,!1,null,"6e3b6b8e",null)),vn=fn.exports,hn=function(){var e=this,t=e._self._c;return e.visible?t("div",{staticClass:"overlay"},[t("div",{staticClass:"kasbon-detail"},[t("h2",[e._v("Detail Kasbon "+e._s(e.kasbon.ref_no))]),t("p",[t("strong",[e._v("Jumlah:")]),e._v(" "+e._s(e.formatCurrency(e.kasbon.amount)))]),t("p",[t("strong",[e._v("Angsuran per Bulan:")]),e._v(" "+e._s(e.formatCurrency(e.kasbon.angsuran_perbulan)))]),t("p",[t("strong",[e._v("Tenor:")]),e._v(" "+e._s(e.kasbon.tenor)+" bulan")]),t("p",[t("strong",[e._v("Status:")]),e._v(" "+e._s(e.kasbon.status))]),t("p",[t("strong",[e._v("Keperluan:")]),e._v(" "+e._s(e.kasbon.keperluan))]),t("p",[t("strong",[e._v("Jaminan:")]),e._v(" "+e._s(e.kasbon.jaminan||"Tidak ada"))]),t("p",[t("strong",[e._v("Kepemilikan Jaminan:")]),e._v(" "+e._s(e.kasbon.owned_jaminan))]),t("p",[t("strong",[e._v("Masa Berlaku Jaminan:")]),e._v(" "+e._s(e.kasbon.expire_date_jaminan||"Tidak ada"))]),t("p",[t("strong",[e._v("Catatan:")]),e._v(" "+e._s(e.kasbon.note||"Tidak ada catatan"))]),e.kasbon.documents&&e.kasbon.documents.length?t("div",{staticClass:"document-container"},[t("h3",[e._v("Dokumen")]),e._l(e.kasbon.documents,(function(a,n){return t("div",{key:n,staticClass:"document-wrapper"},[t("img",{staticClass:"document-image",attrs:{src:a.uri},on:{click:function(t){return e.showFullscreen(a.uri)}}})])}))],2):e._e(),e.fullscreenImage?t("div",{staticClass:"fullscreen-overlay",on:{click:function(t){e.fullscreenImage=null}}},[t("img",{staticClass:"fullscreen-image",attrs:{src:e.fullscreenImage}})]):e._e(),t("button",{staticClass:"close-button",on:{click:function(t){return e.$emit("close")}}},[e._v("Tutup")])])]):e._e()},gn=[],bn={props:["kasbon","visible"],data:function(){return{fullscreenImage:null}},methods:{formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)},showFullscreen:function(e){this.fullscreenImage=e}}},_n=bn,kn=(a("4e79"),Object(N["a"])(_n,hn,gn,!1,null,"fe8b91f0",null)),Cn=kn.exports,wn=function(){var e=this,t=e._self._c;return e.visible?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h2",[e._v("Form Kasbon")]),t("div",{staticClass:"form-container"},[e._m(0),t("input",{directives:[{name:"model",rawName:"v-model",value:e.amount,expression:"amount"}],staticClass:"input",attrs:{type:"number",placeholder:"Jumlah Pengajuan"},domProps:{value:e.amount},on:{input:[function(t){t.target.composing||(e.amount=t.target.value)},e.calculateAngsuranPerBulan]}}),e._m(1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.keperluan,expression:"keperluan"}],staticClass:"input",attrs:{type:"text",placeholder:"Keperluan"},domProps:{value:e.keperluan},on:{input:function(t){t.target.composing||(e.keperluan=t.target.value)}}}),e._m(2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.tenor,expression:"tenor"}],staticClass:"input",on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.tenor=t.target.multiple?a:a[0]},e.calculateAngsuranPerBulan]}},e._l(24,(function(a){return t("option",{key:a,domProps:{value:a}},[e._v(e._s(a)+" bulan")])})),0),t("label",{staticClass:"label"},[e._v("Angsuran Per Bulan")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.angsuranPerBulan,expression:"angsuranPerBulan"}],staticClass:"input",attrs:{type:"text",placeholder:"Angsuran Per Bulan",readonly:""},domProps:{value:e.angsuranPerBulan},on:{input:function(t){t.target.composing||(e.angsuranPerBulan=t.target.value)}}}),t("label",{staticClass:"label"},[e._v("Jaminan")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.jaminan,expression:"jaminan"}],staticClass:"input",attrs:{type:"text",placeholder:"Jaminan yang diberikan"},domProps:{value:e.jaminan},on:{input:function(t){t.target.composing||(e.jaminan=t.target.value)}}}),t("label",{staticClass:"label"},[e._v("Masa berlaku jaminan")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.expireDateJaminan,expression:"expireDateJaminan"}],staticClass:"input",attrs:{type:"date",placeholder:"Masa berlaku"},domProps:{value:e.expireDateJaminan},on:{input:function(t){t.target.composing||(e.expireDateJaminan=t.target.value)}}}),t("label",{staticClass:"label"},[e._v("Kepemilikan jaminan")]),t("button",{staticClass:"input",on:{click:e.toggleOwnedJaminan}},[e._v(e._s(e.ownedJaminan))]),t("label",{staticClass:"label"},[e._v("Catatan")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note,expression:"note"}],staticClass:"input",attrs:{placeholder:"Catatan"},domProps:{value:e.note},on:{input:function(t){t.target.composing||(e.note=t.target.value)}}}),t("div",{staticClass:"document-container"},[t("input",{ref:"fileInput",attrs:{type:"file",accept:"image/*",hidden:"",multiple:""},on:{change:e.openDocumentPicker}}),t("button",{staticClass:"add-button",on:{click:e.selectImage}},[t(vt["a"],{attrs:{left:""}},[e._v("mdi-paperclip")])],1),e._l(e.documents,(function(a,n){return t("div",{key:n,staticClass:"document-wrapper"},[t("img",{staticClass:"document-image",attrs:{src:a.uri},on:{click:function(t){return e.showFullscreen(a.uri)}}}),t("button",{staticClass:"remove-button",on:{click:function(t){return e.removeDocument(n)}}},[e._v("❌")])])}))],2),e.fullscreenImage?t("div",{staticClass:"fullscreen-overlay",on:{click:function(t){e.fullscreenImage=null}}},[t("img",{staticClass:"fullscreen-image",attrs:{src:e.fullscreenImage}})]):e._e(),t("div",{staticClass:"button-container"},[t("button",{staticClass:"close-button",on:{click:e.onClose}},[e._v("Tutup")]),t("button",{staticClass:"submit-button",attrs:{disabled:e.loading},on:{click:e.handleSubmit}},[e._v(" "+e._s(e.loading?"Mengirim...":"Submit")+" ")])])])])]):e._e()},yn=[function(){var e=this,t=e._self._c;return t("label",{staticClass:"label"},[e._v("Jumlah: "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"label"},[e._v("Keperluan: "),t("span",{staticClass:"required"},[e._v("*")])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"label"},[e._v("Tenor (1 - 24 bulan) "),t("span",{staticClass:"required"},[e._v("*")])])}],xn={props:["visible"],emits:["close","refreshData"],data:function(){return{amount:"",keperluan:"",tenor:1,angsuranPerBulan:"",jaminan:"",expireDateJaminan:"",ownedJaminan:"milik sendiri",note:"",documents:[],loading:!1,isVisible:this.visible,fullscreenImage:null}},watch:{visible:function(e){this.isVisible=e}},methods:{selectImage:function(){this.$refs.fileInput.click()},onClose:function(){this.isVisible=!1,this.$emit("close")},openDocumentPicker:function(e){for(var t=this,a=e.target.files,n=0;n<a.length;n++){var r=a[n],s=new FileReader;s.onload=function(e){t.documents.push({uri:e.target.result})},s.readAsDataURL(r)}},toggleOwnedJaminan:function(){this.ownedJaminan="milik sendiri"===this.ownedJaminan?"bukan hak milik":"milik sendiri"},removeDocument:function(e){this.documents.splice(e,1)},handleSubmit:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.amount&&e.keperluan&&e.tenor){t.next=3;break}return alert("Semua field yang wajib diisi harus diisi."),t.abrupt("return");case 3:return e.loading=!0,a=new FormData,a.append("amount",e.amount),a.append("keperluan",e.keperluan),a.append("tenor",e.tenor),a.append("angsuran_per_bulan",e.angsuranPerBulan),a.append("jaminan",e.jaminan),a.append("expire_date_jaminan",e.expireDateJaminan),a.append("owned_jaminan",e.ownedJaminan),a.append("note",e.note),e.documents.forEach((function(e){a.append("documents[]",e)})),t.prev=14,t.next=17,T.post("/kasbon/post-kasbon-form-data",a,{headers:{"Content-Type":"multipart/form-data"}});case 17:n=t.sent,200===n.status&&(e.resetForm(),e.$emit("refreshData"),null===(r=e.$toast)||void 0===r||r.success("Data berhasil diajukan."),e.$emit("close")),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](14),null===(s=e.$toast)||void 0===s||s.error("Gagal mengirim data. Silakan coba lagi.");case 24:return t.prev=24,e.loading=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[14,21,24,27]])})))()},showFullscreen:function(e){this.fullscreenImage=e},resetForm:function(){this.amount="",this.keperluan="",this.tenor=1,this.angsuranPerBulan="",this.jaminan="",this.expireDateJaminan="",this.ownedJaminan="milik sendiri",this.note="",this.documents=[]},formatAmount:function(){var e=parseFloat(this.amount.replace(/[^\d]/g,""));isNaN(e)||(this.amount=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)),this.calculateAngsuranPerBulan()},calculateAngsuranPerBulan:function(){var e=parseFloat(this.amount.replace(/[^\d]/g,""));if(!isNaN(e)&&this.tenor){var t=e/this.tenor;this.angsuranPerBulan=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(t)}else this.angsuranPerBulan=""}}},On=xn,Pn=(a("95f3"),Object(N["a"])(On,wn,yn,!1,null,"ce9b00dc",null)),Sn=Pn.exports,jn={components:{KasbonForm:Sn,KasbonItem:vn,KasbonDetail:Cn},data:function(){return{kasbonList:[],selectedKasbon:null,loading:!1,modalVisible:!1,visibleForm:!1}},methods:{fetchKasbonList:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,T.get("/kasbon/get-kasbon-list");case 4:a=t.sent,e.kasbonList=a.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error("Error fetching kasbon list:",t.t0);case 11:return t.prev=11,e.loading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},showKasbonDetail:function(e){this.selectedKasbon=e,this.modalVisible=!0},closeModal:function(){this.modalVisible=!1,this.selectedKasbon=null}},mounted:function(){this.fetchKasbonList()}},Ln=jn,Dn=(a("019a"),Object(N["a"])(Ln,ln,cn,!1,null,"387ff0c9",null)),In=Dn.exports,Fn=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"container"},[t("h1",{staticClass:"title"},[e._v("Tentang Aplikasi")]),e._m(0),e._m(1),e._m(2),e._m(3),e._m(4),e._m(5),e._m(6),e._m(7),t("p",{staticClass:"footer"},[e._v(" Aplikasi ini dirancang untuk mempermudah manajemen operasional perusahaan secara menyeluruh. ")]),e._m(8),e._m(9),t("section",[t("h2",{staticClass:"section-title"},[e._v("Versi Aplikasi")]),t("p",{staticClass:"version-text"},[e._v("Versi "+e._s(e.version))])])])])},Rn=[function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Deskripsi")]),t("p",{staticClass:"text"},[e._v(" Aplikasi ini dibuat untuk mempermudah operasional perusahaan dalam mengelola dan memonitor berbagai aktivitas, termasuk pengelolaan material, pemesanan barang (PO), pengaduan, dan distribusi. Dengan fitur-fitur yang mudah digunakan, aplikasi ini membantu meningkatkan efisiensi dan produktivitas tim. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Absensi Kehadiran")]),t("p",{staticClass:"text"},[e._v(" Fitur ini digunakan untuk mencatat kehadiran karyawan di perusahaan. Setiap karyawan dapat melakukan absensi masuk dan keluar melalui aplikasi ini, sehingga memudahkan pencatatan jam kerja. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Tugas Rutinitas")]),t("p",{staticClass:"text"},[e._v(" Fitur ini mencakup tugas-tugas yang perlu dilakukan secara rutin oleh karyawan. Fitur ini membantu mengorganisir jadwal dan memastikan semua pekerjaan terselesaikan tepat waktu. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Service Call (Complain / Service Internal)")]),t("p",{staticClass:"text"},[e._v(" Bagian ini berfungsi untuk mencatat dan memonitor keluhan (complain) dari pelanggan atau internal perusahaan. Keluhan yang masuk akan ditangani oleh tim operasional sesuai dengan kebutuhan. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Operasional")]),t("p",{staticClass:"text"},[e._v(" Bagian ini mencakup pengelolaan data operasional seperti toko, purchase order (PO), dan complain. Semua aktivitas operasional bisa dipantau dan di-update langsung dari aplikasi. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Material dan Distribusinya")]),t("p",{staticClass:"text"},[e._v(" Fitur ini mengatur dan memantau penggunaan serta distribusi material untuk setiap proyek. Setiap barang yang keluar akan tercatat dan distribusi material ke toko atau proyek dapat dipantau secara real-time. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Asset / Tooling (Peminjaman Asset / Alat Pekerjaan)")]),t("p",{staticClass:"text"},[e._v(" Fitur ini berfungsi untuk mengelola daftar aset atau alat yang dipinjam oleh karyawan. Setiap alat yang dipinjam, waktu peminjaman, dan pengembalian alat dicatat untuk memudahkan kontrol aset dan peralatan kerja. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Hutang / Kasbon Karyawan")]),t("p",{staticClass:"text"},[e._v(" Bagian ini memungkinkan karyawan untuk mengajukan hutang atau kasbon, yang nantinya dapat dipantau oleh bagian keuangan perusahaan. Setiap pengajuan kasbon akan tercatat secara sistematis. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Tujuan")]),t("p",{staticClass:"text"},[e._v(" Tujuan dari aplikasi ini adalah untuk memberikan solusi yang terintegrasi bagi tim operasional agar dapat bekerja lebih efisien dalam mengelola sumber daya, melacak status pemesanan, serta menyelesaikan pengaduan dengan lebih cepat. ")])])},function(){var e=this,t=e._self._c;return t("section",[t("h2",{staticClass:"section-title"},[e._v("Pengembang")]),t("p",{staticClass:"text"},[e._v(" Aplikasi ini dikembangkan oleh Tim IT Operasional dengan tujuan untuk terus meningkatkan kinerja dan mempercepat proses kerja di lapangan. ")])])}],Tn="1.0",Mn=Tn,An={components:{},data:function(){return{version:Mn}}},Nn=An,En=(a("c1d6"),Object(N["a"])(Nn,Fn,Rn,!1,null,"51113013",null)),qn=En.exports,$n=function(){var e=this,t=e._self._c;return t("div",[e.previewImages.length?t("div",{staticClass:"preview-image-container"},e._l(e.previewImages,(function(a,n){return t("div",{key:n,staticClass:"preview-image-wrapper"},[t("img",{staticClass:"preview-image",attrs:{src:a.data,alt:a.name}}),t("div",{staticClass:"image-details"},[t("span",[e._v("Size: "+e._s(e.formatFileSize(a.size)))])]),t("span",{staticClass:"remove-image",on:{click:function(t){return e.removePreviewImage(n)}}},[e._v("×")])])})),0):e._e(),t("div",{staticClass:"input-form"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.additionalText,expression:"additionalText"}],staticClass:"text-input",attrs:{placeholder:"Tambahkan pesan..."},domProps:{value:e.additionalText},on:{input:function(t){t.target.composing||(e.additionalText=t.target.value)}}}),t("div",{staticClass:"icons"},[t("label",{staticClass:"file-upload-button",attrs:{for:"file-upload"}},[t("i",{staticClass:"fas fa-paperclip"}),t("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{id:"file-upload",type:"file",multiple:"",accept:"image/*"},on:{change:e.handleFileUpload}})]),t("button",{staticClass:"send-button",on:{click:e.submitData}},[t("i",{staticClass:"fas fa-paper-plane"})])])]),e.isCompressing?t("div",{staticClass:"compressing-indicator"},[t("i",{staticClass:"fas fa-spinner fa-spin"}),e._v(" Mengompres gambar... ")]):e._e()])},Bn=[],zn={data:function(){return{task:this.$route.params.task||null,additionalText:"",previewImages:[],isModalVisible:!1,currentUserId:JSON.parse(localStorage.getItem("user_id")||"1"),isCompressing:!1}},created:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.comments=e.task.task.comments||[],setTimeout((function(){e.scrollToBottom()}),500);case 2:case"end":return t.stop()}}),t)})))()},methods:{fetchTask:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.prev=1,a.next=4,T.get("/task/".concat(e));case 4:return n=a.sent,a.abrupt("return",n.data[0]);case 8:a.prev=8,a.t0=a["catch"](1),console.error("Error fetching service call:",a.t0),r.a.$toast.error("Error","Gagal memuat data service call.");case 12:return a.prev=12,t.loading=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[1,8,12,15]])})))()},formatDate:function(e){var t=new Date(e);return t.toLocaleDateString("id-ID")},formatFileSize:function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(0)+" "+["B","kB","MB","GB","TB"][t]},handleFileUpload:function(e){var t=this,a=Array.from(e.target.files);this.isCompressing=!0,console.log("Starting compression..."),Promise.all(a.map((function(e){return t.readAndCompressImage(e)}))).then((function(e){var a;console.log("Compressed Images:",e),(a=t.previewImages).push.apply(a,Object(ge["a"])(e))})).finally((function(){t.isCompressing=!1}))},readAndCompressImage:function(e){var t=this;return new Promise((function(a,n){var s=new FileReader;e.type.startsWith("image/")?(s.onload=function(){var r=Object(h["a"])(regeneratorRuntime.mark((function r(s){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.compressImage(s.target.result,e.name);case 3:i=r.sent,console.log("Compressed Image:",i),a(i),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),n(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}(),s.onerror=function(e){return n(e)},s.readAsDataURL(e)):r.a.$toast.error("Hanya file gambar yang diperbolehkan.")}))},compressImage:function(e,t){return Object(h["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new Image,n.src=e,a.abrupt("return",new Promise((function(e,a){n.onload=function(){var r=document.createElement("canvas"),s=r.getContext("2d"),i=800,o=n.width,l=n.height;o>l?o>i&&(l=Math.round(l*=i/o),o=i):l>i&&(o=Math.round(o*=i/l),l=i),r.width=o,r.height=l,s.drawImage(n,0,0,o,l);var c,u=.8;do{c=r.toDataURL("image/jpeg",u);for(var d=atob(c.split(",")[1]),m=new ArrayBuffer(d.length),p=new Uint8Array(m),f=0;f<d.length;f++)p[f]=d.charCodeAt(f);var v=new Blob([m],{type:"image/jpeg"});if(v.size<=204800)return void e({name:t,data:c,file:v,filemtime:Date.now(),size:v.size});u-=.1}while(u>0);a("Failed to compress image below 200KB")},n.onerror=function(e){return a(e)}})));case 3:case"end":return a.stop()}}),a)})))()},removePreviewImage:function(e){this.previewImages.splice(e,1),this.$refs.fileUpload.value=null},submitData:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var a,n,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.additionalText.trim()){t.next=3;break}return r.a.$toast.error("Tambahkan pesan terlebih dahulu"),t.abrupt("return");case 3:return t.next=5,U();case 5:if(a=t.sent,n=a.position,n){t.next=10;break}return r.a.$toast.error("Aktifkan GPS!"),t.abrupt("return");case 10:return s=new FormData,s.append("alfa_id",e.task.id),s.append("task_id",e.task.task.id),s.append("comment",e.additionalText),s.append("latitude",n.coords.latitude),s.append("longitude",n.coords.longitude),e.previewImages.forEach((function(e){s.append("photos[]",e.file,e.name),s.append("filemtimes[]",e.filemtime)})),t.prev=17,t.next=20,T.post("/task",s,{headers:{"Content-Type":"multipart/form-data"}});case 20:if(i=t.sent,o=i.data,!o.success){t.next=29;break}return e.comments=o.data.comments,e.additionalText="",e.previewImages=[],e.scrollToBottom(),t.next=29,D("tasks",e.task.id,e.comments,"comments");case 29:t.next=34;break;case 31:t.prev=31,t.t0=t["catch"](17),console.error("Error submitting data:",t.t0);case 34:case"end":return t.stop()}}),t,null,[[17,31]])})))()},openModal:function(){this.isModalVisible=!0},closeModal:function(){this.isModalVisible=!1},handleSuccess:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.success){a.next=4;break}return t.task.note=e.reminderText,a.next=4,D("tasks",t.task.id,e.reminderText,"note");case 4:console.log("Reminder added successfully:",e);case 5:case"end":return a.stop()}}),a)})))()},scrollToBottom:function(){var e=this;this.$nextTick((function(){var t=e.$refs.detailTaskContainer;setTimeout((function(){t.scrollTop=t.scrollHeight}),200)}))}}},Un=zn,Vn=(a("5b3c"),Object(N["a"])(Un,$n,Bn,!1,null,"68342e2f",null)),Kn=Vn.exports,Jn=[{path:"/",exact:!0,component:ie,icon:"home",name:"Home",meta:{requiresAuth:!0}},{path:"/task",exact:!0,component:fe,icon:"psychology",name:"Task",meta:{requiresAuth:!0}},{path:"/task/:id",exact:!0,component:Le,icon:"psychology",name:"DetailTask",meta:{requiresAuth:!0}},{path:"/service-call",exact:!0,component:Ne,icon:"psychology",name:"ServiceCall",meta:{requiresAuth:!0}},{path:"/service-call/:id",exact:!0,component:Ke,icon:"psychology",name:"DetailServiceCall",meta:{requiresAuth:!0}},{path:"/menu",exact:!0,component:Ye,name:"Menu",meta:{requiresAuth:!0}},{path:"/operasional",exact:!0,component:Vt,name:"Operasional",meta:{requiresAuth:!0}},{path:"/operasional-form",exact:!0,component:Xt,name:"OperasionalForm",meta:{requiresAuth:!0}},{path:"/material",exact:!0,component:Oa,name:"Material",meta:{requiresAuth:!0}},{path:"/material-form",exact:!0,component:Ra,name:"MaterialForm",meta:{requiresAuth:!0}},{path:"/tooling",exact:!0,component:Za,name:"Tooling",meta:{requiresAuth:!0}},{path:"/tooling-form",exact:!0,component:on,name:"ToolingForm",meta:{requiresAuth:!0}},{path:"/profile",exact:!0,component:Ba,icon:"psychology",name:"Profile",meta:{requiresAuth:!0}},{path:"/edit-profile",exact:!0,component:Ha,icon:"psychology",name:"EditProfile",meta:{requiresAuth:!0}},{path:"/kasbon",exact:!0,component:In,icon:"psychology",name:"Kasbon",meta:{requiresAuth:!0}},{path:"/kasbon-form",exact:!0,component:Sn,icon:"psychology",name:"KasbonForm",meta:{requiresAuth:!0}},{path:"/about",exact:!0,component:qn,icon:"psychology",name:"About",meta:{requiresAuth:!0}},{path:"/login",exact:!0,component:q,icon:"question_answer",name:"Login"},{path:"/test",exact:!0,component:Kn,icon:"question_answer",name:"Test"},{path:"*",redirect:"/"}],Hn=new i["a"]({routes:Jn,mode:"history"});Hn.beforeEach((function(e,t,a){var n=localStorage.getItem("api_token");e.matched.some((function(e){return e.meta.requiresAuth}))&&!n?a("/login"):a()}));var Qn=Hn,Gn=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app","data-app":""}},[t("Header"),t("NavTabs"),t("router-view"),t("Spinner")],1)},Wn=[],Yn=function(){var e=this,t=e._self._c;return e.isLoggedIn?t("header",{staticClass:"header"},[e._m(0),t("div",{staticClass:"date"},[e._v(" "+e._s(e.currentDate)+" ")])]):e._e()},Xn=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"logo"},[t("span",{staticClass:"logo-text"},[e._v("INDOBENUA")])])}];function Zn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function er(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Zn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var tr={name:"Header",computed:er({},Object(k["c"])({isLoggedIn:function(e){return!!e.user}})),data:function(){return{currentDate:""}},mounted:function(){this.updateCurrentDate()},methods:{updateCurrentDate:function(){var e=new Date,t={weekday:"long",year:"numeric",month:"long",day:"numeric"};this.currentDate=e.toLocaleDateString("id-ID",t)}}},ar=tr,nr=(a("88cc"),Object(N["a"])(ar,Yn,Xn,!1,null,"7602e895",null)),rr=nr.exports,sr=function(){var e=this,t=e._self._c;return e.isLoggedIn?t("nav",{staticClass:"nav-tabs"},[t("router-link",{staticClass:"nav-link",attrs:{to:"/"}},[e._v("Home")]),t("router-link",{staticClass:"nav-link",attrs:{to:"/task"}},[e._v(" Task "),e.statistics.task_count?t("span",{staticClass:"badge"},[e._v(e._s(e.statistics.task_count))]):e._e()]),t("router-link",{staticClass:"nav-link",attrs:{to:"/service-call"}},[e._v(" Complain "),e.statistics.sc_count?t("span",{staticClass:"badge"},[e._v(e._s(e.statistics.sc_count))]):e._e()]),t("router-link",{staticClass:"nav-link",attrs:{to:"/menu"}},[t("i",{staticClass:"fas fa-bars"})])],1):e._e()},ir=[];function or(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function lr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?or(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):or(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var cr={name:"NavTabs",computed:lr({},Object(k["c"])({isLoggedIn:function(e){return!!e.user},statistics:function(e){return e.statistic}}))},ur=cr,dr=(a("4142"),Object(N["a"])(ur,sr,ir,!1,null,"3c1ad0ac",null)),mr=dr.exports,pr=function(){var e=this,t=e._self._c;return e.isLoading?t("div",{staticClass:"spinner-overlay"},[t("div",{staticClass:"spinner"})]):e._e()},fr=[];function vr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function hr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var gr={computed:hr({},Object(k["c"])({isLoading:function(e){return e.isLoading}}))},br=gr,_r=(a("f364"),Object(N["a"])(br,pr,fr,!1,null,"3ac66530",null)),kr=_r.exports;function Cr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function wr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(a),!0).forEach((function(t){Object(z["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var yr={name:"App",components:{Header:rr,NavTabs:mr,Spinner:kr},created:function(){this.fetchUser(),this.setStatistic()},methods:wr({},Object(k["b"])(["fetchUser","setStatistic"]))},xr=yr,Or=(a("4e4c"),Object(N["a"])(xr,Gn,Wn,!1,null,null,null)),Pr=Or.exports,Sr=a("1881"),jr=a.n(Sr);r.a.use(m.a,{name:"v-touch"}),r.a.use(p["default"]),r.a.use(jr.a,{dynamic:!0,injectModalsContainer:!0}),r.a.config.productionTip=!1,r.a.prototype.$axios=T,new r.a({store:C,router:Qn,render:function(e){return e(Pr)}}).$mount("#app")},"5b3c":function(e,t,a){"use strict";a("2c25")},"5d0c":function(e,t,a){"use strict";a("0f1d")},"5da2":function(e,t,a){},"5fa1":function(e,t,a){},6476:function(e,t,a){"use strict";a("4551")},"64a4":function(e,t,a){"use strict";a("16df")},"743e":function(e,t,a){"use strict";a("be9e")},"7de6":function(e,t,a){},"80c7":function(e,t,a){},8806:function(e,t,a){"use strict";a("aed0")},"88cc":function(e,t,a){"use strict";a("80c7")},"8c6b":function(e,t,a){},"8e99":function(e,t,a){"use strict";a("e8c7")},9074:function(e,t,a){},"95f3":function(e,t,a){"use strict";a("c4e2")},9650:function(e,t,a){"use strict";a("cbc1")},9864:function(e,t,a){},"9c7a":function(e,t,a){},a98b:function(e,t,a){},ab0f:function(e,t,a){},ab6e:function(e,t,a){"use strict";a("b3e1")},ad2a:function(e,t,a){"use strict";a("8c6b")},aed0:function(e,t,a){},b3e1:function(e,t,a){},b4d8:function(e,t,a){"use strict";a("1bfe")},be9e:function(e,t,a){},c1d6:function(e,t,a){"use strict";a("4de4")},c25e:function(e,t,a){},c4e2:function(e,t,a){},c639:function(e,t,a){"use strict";a("9074")},c845:function(e,t,a){},cbc1:function(e,t,a){},cc26:function(e,t,a){"use strict";a("1add")},d207:function(e,t,a){},d826:function(e,t,a){},e8c7:function(e,t,a){},e9d1:function(e,t,a){"use strict";a("42dd")},ef38:function(e,t,a){},f364:function(e,t,a){"use strict";a("37d2")},f376:function(e,t,a){},fedb:function(e,t,a){"use strict";a("7de6")}});
//# sourceMappingURL=app.15af7e44.js.map